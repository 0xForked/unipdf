//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package redactor ;import (_gb "errors";_g "fmt";_gc "github.com/unidoc/unipdf/v3/common";_ab "github.com/unidoc/unipdf/v3/contentstream";_gd "github.com/unidoc/unipdf/v3/core";_d "github.com/unidoc/unipdf/v3/creator";_ee "github.com/unidoc/unipdf/v3/extractor";
_da "github.com/unidoc/unipdf/v3/model";_f "io";_e "regexp";_ac "sort";_c "strings";);

// Redactor represents a Redactor object.
type Redactor struct{_bfbe *_da .PdfReader ;_ebb *RedactionOptions ;_aebcg *_d .Creator ;_dgb *RectangleProps ;};func _dgg (_dfa string ,_fecf []replacement ,_bagc *_da .PdfFont )[]_gd .PdfObject {_befb :=[]_gd .PdfObject {};_fafa :=0;_bff :=_dfa ;for _cffc ,_fcgc :=range _fecf {_cffe :=_fcgc ._ae ;
_ggb :=_fcgc ._ag ;_ecbg :=_fcgc ._ff ;_gdc :=_gd .MakeFloat (_ggb );if _fafa > _cffe ||_cffe ==-1{continue ;};_cddg :=_dfa [_fafa :_cffe ];_ffb :=_accf (_cddg ,_bagc );_cgg :=_gd .MakeStringFromBytes (_ffb );_befb =append (_befb ,_cgg );_befb =append (_befb ,_gdc );
_cbd :=_cffe +len (_ecbg );_bff =_dfa [_cbd :];_fafa =_cbd ;if _cffc ==len (_fecf )-1{_ffb =_accf (_bff ,_bagc );_cgg =_gd .MakeStringFromBytes (_ffb );_befb =append (_befb ,_cgg );};};return _befb ;};func _fcc (_gdcd *_ab .ContentStreamOperations ,PdfObj _gd .PdfObject )(*_ab .ContentStreamOperation ,int ,bool ){for _fgf ,_ffbb :=range *_gdcd {_gega :=_ffbb .Operand ;
if _gega =="\u0054\u006a"{_dad :=_gd .TraceToDirectObject (_ffbb .Params [0]);if _dad ==PdfObj {return _ffbb ,_fgf ,true ;};}else if _gega =="\u0054\u004a"{_efd ,_bed :=_gd .GetArray (_ffbb .Params [0]);if !_bed {return nil ,_fgf ,_bed ;};for _ ,_bfe :=range _efd .Elements (){if _bfe ==PdfObj {return _ffbb ,_fgf ,true ;
};};}else if _gega =="\u0022"{_agb :=_gd .TraceToDirectObject (_ffbb .Params [2]);if _agb ==PdfObj {return _ffbb ,_fgf ,true ;};}else if _gega =="\u0027"{_cfe :=_gd .TraceToDirectObject (_ffbb .Params [0]);if _cfe ==PdfObj {return _ffbb ,_fgf ,true ;};
};};return nil ,-1,false ;};func _fac (_dbg *_ee .TextMarkArray )[]*_ee .TextMarkArray {_eed :=_dbg .Elements ();_ceb :=len (_eed );var _acd _gd .PdfObject ;_gbg :=[]*_ee .TextMarkArray {};_aaff :=&_ee .TextMarkArray {};_caad :=-1;for _aef ,_dadb :=range _eed {_egd :=_dadb .DirectObject ;
_caad =_dadb .Index ;if _egd ==nil {_gabde :=_bdgc (_dbg ,_aef ,_caad );if _acd !=nil {if _gabde ==-1||_gabde > _aef {_gbg =append (_gbg ,_aaff );_aaff =&_ee .TextMarkArray {};};};}else if _egd !=nil &&_acd ==nil {if _caad ==0&&_aef > 0{_gbg =append (_gbg ,_aaff );
_aaff =&_ee .TextMarkArray {};};}else if _egd !=nil &&_acd !=nil {if _egd !=_acd {_gbg =append (_gbg ,_aaff );_aaff =&_ee .TextMarkArray {};};};_acd =_egd ;_aaff .Append (_dadb );if _aef ==(_ceb -1){_gbg =append (_gbg ,_aaff );};};return _gbg ;};

// RectangleProps defines properties of the redaction rectangle to be drawn.
type RectangleProps struct{FillColor _d .Color ;BorderWidth float64 ;FillOpacity float64 ;};func _fde (_ebg *_ab .ContentStreamOperation ,_feb _gd .PdfObject ,_afd []localSpanMarks )error {var _dcd *_gd .PdfObjectArray ;_bea ,_aca :=_aeb (_afd );if len (_aca )==1{_aea :=_aca [0];
_geg :=_bea [_aea ];if len (_geg )==1{_gag :=_geg [0];_bcb :=_gag ._afae ;_bcc :=_ga (_bcb );_bgg ,_bef :=_cgf (_feb ,_bcc );if _bef !=nil {return _bef ;};_eca ,_bef :=_bfg (_gag ,_bcb ,_bcc ,_bgg ,_aea );if _bef !=nil {return _bef ;};_dcd =_gd .MakeArray (_eca ...);
}else {_add :=_geg [0]._afae ;_dcdd :=_ga (_add );_afe ,_agg :=_cgf (_feb ,_dcdd );if _agg !=nil {return _agg ;};_febf ,_agg :=_caac (_afe ,_geg );if _agg !=nil {return _agg ;};_ede :=_afdb (_febf );_ccf :=_dgg (_afe ,_ede ,_dcdd );_dcd =_gd .MakeArray (_ccf ...);
};}else if len (_aca )> 1{_gfg :=_afd [0];_gegf :=_gfg ._afae ;_ ,_cdfg :=_ba (_gegf );_edg :=_gegf .Elements ()[_cdfg ];_fg :=_edg .Font ;_dgc ,_gba :=_cgf (_feb ,_fg );if _gba !=nil {return _gba ;};_aee ,_gba :=_caac (_dgc ,_afd );if _gba !=nil {return _gba ;
};_fbb :=_afdb (_aee );_ecb :=_dgg (_dgc ,_fbb ,_fg );_dcd =_gd .MakeArray (_ecb ...);};_ebg .Params [0]=_dcd ;_ebg .Operand ="\u0054\u004a";return nil ;};type targetMap struct{_aebcb string ;_eccd [][]int ;};func _fd (_acc *_da .PdfFont ,_cefg _ee .TextMark )float64 {_eb :=0.001;
_fda :=_cefg .Th /100;if _acc .Subtype ()=="\u0054\u0079\u0070e\u0033"{_eb =1;};_gea ,_abd :=_acc .GetRuneMetrics (' ');if !_abd {_gea ,_abd =_acc .GetCharMetrics (32);};if !_abd {_gea ,_ =_da .DefaultFont ().GetRuneMetrics (' ');};_ddb :=_eb *((_gea .Wx *_cefg .FontSize +_cefg .Tc +_cefg .Tw )/_fda );
return _ddb ;};func _dfaf (_fbe ,_aeac ,_dcc float64 )float64 {_dcc =_dcc /100;_egee :=(-1000*_fbe )/(_aeac *_dcc );return _egee ;};type placeHolders struct{_cd []int ;_ec string ;_ce float64 ;};func _aeb (_cac []localSpanMarks )(map[string ][]localSpanMarks ,[]string ){_dec :=make (map[string ][]localSpanMarks );
_dfd :=[]string {};for _ ,_cf :=range _cac {_afg :=_cf ._dbe ;if _ad ,_gfc :=_dec [_afg ];_gfc {_dec [_afg ]=append (_ad ,_cf );}else {_dec [_afg ]=[]localSpanMarks {_cf };_dfd =append (_dfd ,_afg );};};return _dec ,_dfd ;};

// RedactionTerm holds the regexp pattern and the replacement string for the redaction process.
type RedactionTerm struct{Pattern *_e .Regexp ;};func _ccee (_ffga RedactionTerm )(*regexMatcher ,error ){return &regexMatcher {_fef :_ffga },nil };

// New instantiates a Redactor object with given PdfReader and `regex` pattern.
func New (reader *_da .PdfReader ,opts *RedactionOptions ,rectProps *RectangleProps )*Redactor {if rectProps ==nil {rectProps =RedactRectanglePropsNew ();};return &Redactor {_bfbe :reader ,_ebb :opts ,_aebcg :_d .New (),_dgb :rectProps };};func _afdb (_ffgg []placeHolders )[]replacement {_cad :=[]replacement {};
for _ ,_fdc :=range _ffgg {_fbc :=_fdc ._cd ;_bfd :=_fdc ._ec ;_fcd :=_fdc ._ce ;for _ ,_ffa :=range _fbc {_adg :=replacement {_ff :_bfd ,_ag :_fcd ,_ae :_ffa };_cad =append (_cad ,_adg );};};_ac .Slice (_cad ,func (_dece ,_ecd int )bool {return _cad [_dece ]._ae < _cad [_ecd ]._ae });
return _cad ;};func _fb (_df *_ee .TextMarkArray )int {_ecf :=0;_fff :=_df .Elements ();if _fff [0].Text =="\u0020"{_ecf ++;};if _fff [_df .Len ()-1].Text =="\u0020"{_ecf ++;};return _ecf ;};func _cgf (_cffce _gd .PdfObject ,_gabd *_da .PdfFont )(string ,error ){_geaf ,_faa :=_gd .GetStringBytes (_cffce );
if !_faa {return "",_gd .ErrTypeError ;};_edc :=_gabd .BytesToCharcodes (_geaf );_bde ,_cab ,_age :=_gabd .CharcodesToStrings (_edc );if _age > 0{_gc .Log .Debug ("\u0072\u0065nd\u0065\u0072\u0054e\u0078\u0074\u003a\u0020num\u0043ha\u0072\u0073\u003d\u0025\u0064\u0020\u006eum\u004d\u0069\u0073\u0073\u0065\u0073\u003d%\u0064",_cab ,_age );
};_afgb :=_c .Join (_bde ,"");return _afgb ,nil ;};func (_cdfd *regexMatcher )match (_bgeg string )([]*matchedIndex ,error ){_cdfb :=_cdfd ._fef .Pattern ;if _cdfb ==nil {return nil ,_gb .New ("\u006e\u006f\u0020\u0070at\u0074\u0065\u0072\u006e\u0020\u0063\u006f\u006d\u0070\u0069\u006c\u0065\u0064");
};var (_acdg =_cdfb .FindAllStringIndex (_bgeg ,-1);_aaea []*matchedIndex ;);for _ ,_dfeb :=range _acdg {_aaea =append (_aaea ,&matchedIndex {_cccf :_dfeb [0],_dfb :_dfeb [1],_gde :_bgeg [_dfeb [0]:_dfeb [1]]});};return _aaea ,nil ;};func _gdee (_dae []*targetMap ){for _bge ,_ddd :=range _dae {for _dace ,_gdf :=range _dae {if _bge !=_dace {_fbge ,_fgef :=_bead (*_ddd ,*_gdf );
if _fbge {_dba (_gdf ,_fgef );};};};};};func _caac (_gdd string ,_abb []localSpanMarks )([]placeHolders ,error ){_bafc :="";_edb :=[]placeHolders {};for _bag ,_bfbb :=range _abb {_acf :=_bfbb ._afae ;_faf :=_bfbb ._dbe ;_bcd :=_ecc (_acf );_cga ,_ddf :=_abf (_acf );
if _ddf !=nil {return nil ,_ddf ;};if _bcd !=_bafc {var _acgd []int ;if _bag ==0&&_faf !=_bcd {_gdde :=_c .Index (_gdd ,_bcd );_acgd =[]int {_gdde };}else if _bag ==len (_abb )-1{_cfg :=_c .LastIndex (_gdd ,_bcd );_acgd =[]int {_cfg };}else {_acgd =_fcgg (_gdd ,_bcd );
};_cff :=placeHolders {_cd :_acgd ,_ec :_bcd ,_ce :_cga };_edb =append (_edb ,_cff );};_bafc =_bcd ;};return _edb ,nil ;};func _fcgg (_cdeb ,_ded string )[]int {if len (_ded )==0{return nil ;};var _gabf []int ;for _febb :=0;_febb < len (_cdeb );{_bad :=_c .Index (_cdeb [_febb :],_ded );
if _bad < 0{return _gabf ;};_gabf =append (_gabf ,_febb +_bad );_febb +=_bad +len (_ded );};return _gabf ;};func _cebc (_cafab *matchedIndex ,_fag [][]int )[]*matchedIndex {_bdc :=[]*matchedIndex {};_dcg :=_cafab ._cccf ;_bbed :=_dcg ;_bcce :=_cafab ._gde ;
_bbede :=0;for _ ,_aac :=range _fag {_agc :=_aac [0]-_dcg ;if _bbede >=_agc {continue ;};_gedb :=_bcce [_bbede :_agc ];_egc :=&matchedIndex {_gde :_gedb ,_cccf :_bbed ,_dfb :_aac [0]};if len (_c .TrimSpace (_gedb ))!=0{_bdc =append (_bdc ,_egc );};_bbede =_aac [1]-_dcg ;
_bbed =_dcg +_bbede ;};_daf :=_bcce [_bbede :];_bggg :=&matchedIndex {_gde :_daf ,_cccf :_bbed ,_dfb :_cafab ._dfb };if len (_c .TrimSpace (_daf ))!=0{_bdc =append (_bdc ,_bggg );};return _bdc ;};func _bdgc (_ffcg *_ee .TextMarkArray ,_gccfe int ,_acb int )int {_gbcc :=_ffcg .Elements ();
_bafcc :=_gccfe -1;_ebda :=_gccfe +1;_addc :=-1;if _bafcc >=0{_effg :=_gbcc [_bafcc ];_bebf :=_effg .ObjString ;_ccbc :=len (_bebf );_gddb :=_effg .Index ;if _gddb +1< _ccbc {_addc =_bafcc ;return _addc ;};};if _ebda < len (_gbcc ){_dfdc :=_gbcc [_ebda ];
_aec :=_dfdc .ObjString ;if _aec [0]!=_dfdc .Text {_addc =_ebda ;return _addc ;};};return _addc ;};func _bfg (_ceg localSpanMarks ,_aebc *_ee .TextMarkArray ,_gda *_da .PdfFont ,_ege ,_fga string )([]_gd .PdfObject ,error ){_dac :=_ecc (_aebc );Tj ,_cde :=_abf (_aebc );
if _cde !=nil {return nil ,_cde ;};_fdb :=len (_ege );_ecfg :=len (_dac );_fae :=-1;_dcbb :=_gd .MakeFloat (Tj );if _dac !=_fga {_becf :=_ceg ._eeb ;if _becf ==0{_fae =_c .LastIndex (_ege ,_dac );}else {_fae =_c .Index (_ege ,_dac );};}else {_fae =_c .Index (_ege ,_dac );
};_bd :=_fae +_ecfg ;_fbf :=[]_gd .PdfObject {};if _fae ==0&&_bd ==_fdb {_fbf =append (_fbf ,_dcbb );}else if _fae ==0&&_bd < _fdb {_cfc :=_accf (_ege [_bd :],_gda );_beb :=_gd .MakeStringFromBytes (_cfc );_fbf =append (_fbf ,_dcbb ,_beb );}else if _fae > 0&&_bd >=_fdb {_edec :=_accf (_ege [:_fae ],_gda );
_cbg :=_gd .MakeStringFromBytes (_edec );_fbf =append (_fbf ,_cbg ,_dcbb );}else if _fae > 0&&_bd < _fdb {_gfb :=_accf (_ege [:_fae ],_gda );_adf :=_accf (_ege [_bd :],_gda );_baa :=_gd .MakeStringFromBytes (_gfb );_ece :=_gd .MakeString (string (_adf ));
_fbf =append (_fbf ,_baa ,_dcbb ,_ece );};return _fbf ,nil ;};type replacement struct{_ff string ;_ag float64 ;_ae int ;};func _bbd (_bgdba int ,_febc []int )bool {for _ ,_ddc :=range _febc {if _ddc ==_bgdba {return true ;};};return false ;};func _ga (_dcb *_ee .TextMarkArray )*_da .PdfFont {_ ,_cag :=_ba (_dcb );
_aae :=_dcb .Elements ()[_cag ];_ffg :=_aae .Font ;return _ffg ;};func (_dfe *Redactor )redactPage (_bee *_ab .ContentStreamOperations ,_bgdb *_da .PdfPageResources )([]matchedBBox ,*_ab .ContentStreamOperations ,error ){_dfda ,_gfcg :=_ee .NewFromContents (_bee .String (),_bgdb );
if _gfcg !=nil {return nil ,nil ,_gfcg ;};_fbbf ,_ ,_ ,_gfcg :=_dfda .ExtractPageText ();if _gfcg !=nil {return nil ,nil ,_gfcg ;};_bee =_fbbf .GetContentStreamOps ();_aedc :=_fbbf .Marks ();_dda :=_fbbf .Text ();_dda ,_dcab :=_afee (_dda );_gca :=[]matchedBBox {};
_ddag :=make (map[_gd .PdfObject ][]localSpanMarks );_bcde :=[]*targetMap {};for _ ,_bba :=range _dfe ._ebb .Terms {_faab ,_ebe :=_ccee (_bba );if _ebe !=nil {return nil ,nil ,_ebe ;};_dggf ,_ebe :=_faab .match (_dda );if _ebe !=nil {return nil ,nil ,_ebe ;
};_dggf =_cce (_dggf ,_dcab );_aga :=_gccc (_dggf );_bcde =append (_bcde ,_aga ...);};_gdee (_bcde );for _ ,_adc :=range _bcde {_ecg :=_adc ._aebcb ;_adga :=_adc ._eccd ;_fbbd :=[]matchedBBox {};for _ ,_deeb :=range _adga {_bcf ,_ageg ,_ega :=_caf (_deeb ,_aedc ,_ecg );
if _ega !=nil {return nil ,nil ,_ega ;};_ddgb :=_fac (_bcf );for _bbe ,_gbce :=range _ddgb {_faad :=localSpanMarks {_afae :_gbce ,_eeb :_bbe ,_dbe :_ecg };_eba ,_ :=_ba (_gbce );if _fge ,_dab :=_ddag [_eba ];_dab {_ddag [_eba ]=append (_fge ,_faad );}else {_ddag [_eba ]=[]localSpanMarks {_faad };
};};_fbbd =append (_fbbd ,_ageg );};_gca =append (_gca ,_fbbd ...);};_gfcg =_aed (_bee ,_ddag );if _gfcg !=nil {return nil ,nil ,_gfcg ;};return _gca ,_bee ,nil ;};func _cce (_gabff []*matchedIndex ,_dfc [][]int )[]*matchedIndex {_fdec :=[]*matchedIndex {};
for _ ,_gegg :=range _gabff {_bgea ,_afcd :=_dfae (_gegg ,_dfc );if _bgea {_fcf :=_cebc (_gegg ,_afcd );_fdec =append (_fdec ,_fcf ...);}else {_fdec =append (_fdec ,_gegg );};};return _fdec ;};type localSpanMarks struct{_afae *_ee .TextMarkArray ;_eeb int ;
_dbe string ;};type regexMatcher struct{_fef RedactionTerm };

// Write writes the content of `re.creator` to writer of type io.Writer interface.
func (_cfcc *Redactor )Write (writer _f .Writer )error {return _cfcc ._aebcg .Write (writer )};

// RedactRectanglePropsNew return a new pointer to a default RectangleProps object.
func RedactRectanglePropsNew ()*RectangleProps {return &RectangleProps {FillColor :_d .ColorBlack ,BorderWidth :0.0,FillOpacity :1.0};};func _dba (_cffb *targetMap ,_ecea []int ){var _egb [][]int ;for _baag ,_adfc :=range _cffb ._eccd {if _bbd (_baag ,_ecea ){continue ;
};_egb =append (_egb ,_adfc );};_cffb ._eccd =_egb ;};func _dfae (_afea *matchedIndex ,_ffaf [][]int )(bool ,[][]int ){_cead :=[][]int {};for _ ,_fgce :=range _ffaf {if _afea ._cccf < _fgce [0]&&_afea ._dfb > _fgce [1]{_cead =append (_cead ,_fgce );};};
return len (_cead )> 0,_cead ;};

// RedactionOptions is a collection of RedactionTerm objects.
type RedactionOptions struct{Terms []RedactionTerm ;};func _caf (_dcbe []int ,_daea *_ee .TextMarkArray ,_dedb string )(*_ee .TextMarkArray ,matchedBBox ,error ){_dbd :=matchedBBox {};_egbf :=_dcbe [0];_aged :=_dcbe [1];_fgc :=len (_dedb )-len (_c .TrimLeft (_dedb ,"\u0020"));
_beea :=len (_dedb )-len (_c .TrimRight (_dedb ,"\u0020\u000a"));_egbf =_egbf +_fgc ;_aged =_aged -_beea ;_dedb =_c .Trim (_dedb ,"\u0020\u000a");_cfgd ,_gcf :=_daea .RangeOffset (_egbf ,_aged );if _gcf !=nil {return nil ,_dbd ,_gcf ;};_baaf ,_beba :=_cfgd .BBox ();
if !_beba {return nil ,_dbd ,_g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_cfgd );
};_dbd =matchedBBox {_fgb :_dedb ,_ccb :_baaf };return _cfgd ,_dbd ,nil ;};func _ecfe (_ggc *_ab .ContentStreamOperation ,_gf _gd .PdfObject ,_fab []localSpanMarks )error {_gbb ,_dga :=_gd .GetArray (_ggc .Params [0]);_gfe :=[]_gd .PdfObject {};if !_dga {_gc .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0054\u004a\u0020\u006f\u0070\u003d\u0025s\u0020G\u0065t\u0041r\u0072\u0061\u0079\u0056\u0061\u006c\u0020\u0066\u0061\u0069\u006c\u0065\u0064",_ggc );
return _g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_ggc );
};_aeg ,_eg :=_aeb (_fab );if len (_eg )==1{_dc :=_eg [0];_fbg :=_aeg [_dc ];if len (_fbg )==1{_gfeg :=_fbg [0];_cca :=_gfeg ._afae ;_fcg :=_ga (_cca );_ffd ,_be :=_cgf (_gf ,_fcg );if _be !=nil {return _be ;};_bg ,_be :=_bfg (_gfeg ,_cca ,_fcg ,_ffd ,_dc );
if _be !=nil {return _be ;};for _ ,_gbe :=range _gbb .Elements (){if _gbe ==_gf {_gfe =append (_gfe ,_bg ...);}else {_gfe =append (_gfe ,_gbe );};};}else {_ecff :=_fbg [0]._afae ;_ccd :=_ga (_ecff );_db ,_ef :=_cgf (_gf ,_ccd );if _ef !=nil {return _ef ;
};_cb ,_ef :=_caac (_db ,_fbg );if _ef !=nil {return _ef ;};_ge :=_afdb (_cb );_bfb :=_dgg (_db ,_ge ,_ccd );for _ ,_bec :=range _gbb .Elements (){if _bec ==_gf {_gfe =append (_gfe ,_bfb ...);}else {_gfe =append (_gfe ,_bec );};};};_ggc .Params [0]=_gd .MakeArray (_gfe ...);
}else if len (_eg )> 1{_gcc :=_fab [0];_gbd :=_gcc ._afae ;_ ,_ea :=_ba (_gbd );_gccf :=_gbd .Elements ()[_ea ];_ccc :=_gccf .Font ;_af ,_aa :=_cgf (_gf ,_ccc );if _aa !=nil {return _aa ;};_cdb ,_aa :=_caac (_af ,_fab );if _aa !=nil {return _aa ;};_efa :=_afdb (_cdb );
_cge :=_dgg (_af ,_efa ,_ccc );for _ ,_caa :=range _gbb .Elements (){if _caa ==_gf {_gfe =append (_gfe ,_cge ...);}else {_gfe =append (_gfe ,_caa );};};_ggc .Params [0]=_gd .MakeArray (_gfe ...);};return nil ;};func _afee (_gaba string )(string ,[][]int ){_cecf :=_e .MustCompile ("\u005c\u006e");
_faea :=_cecf .FindAllStringIndex (_gaba ,-1);_efe :=_cecf .ReplaceAllString (_gaba ,"\u0020");return _efe ,_faea ;};func _ba (_ed *_ee .TextMarkArray )(_gd .PdfObject ,int ){var _def _gd .PdfObject ;_cef :=-1;for _gbc ,_dge :=range _ed .Elements (){_def =_dge .DirectObject ;
_cef =_gbc ;if _def !=nil {break ;};};return _def ,_cef ;};

// WriteToFile writes the redacted document to file specified by `outputPath`.
func (_ggab *Redactor )WriteToFile (outputPath string )error {if _ccac :=_ggab ._aebcg .WriteToFile (outputPath );_ccac !=nil {return _g .Errorf ("\u0066\u0061\u0069l\u0065\u0064\u0020\u0074o\u0020\u0077\u0072\u0069\u0074\u0065\u0020t\u0068\u0065\u0020\u006f\u0075\u0074\u0070\u0075\u0074\u0020\u0066\u0069\u006c\u0065");
};return nil ;};func _gccc (_afc []*matchedIndex )[]*targetMap {_afcb :=make (map[string ][][]int );_cecc :=[]*targetMap {};for _ ,_cafa :=range _afc {_ade :=_cafa ._gde ;_bgb :=[]int {_cafa ._cccf ,_cafa ._dfb };if _cgad ,_baaa :=_afcb [_ade ];_baaa {_afcb [_ade ]=append (_cgad ,_bgb );
}else {_afcb [_ade ]=[][]int {_bgb };};};for _agbc ,_ged :=range _afcb {_fdce :=&targetMap {_aebcb :_agbc ,_eccd :_ged };_cecc =append (_cecc ,_fdce );};return _cecc ;};

// Redact executes the redact operation on a pdf file and updates the content streams of all pages of the file.
func (_fbfd *Redactor )Redact ()error {_cdc ,_bffe :=_fbfd ._bfbe .GetNumPages ();if _bffe !=nil {return _g .Errorf ("\u0066\u0061\u0069\u006c\u0065\u0064 \u0074\u006f\u0020\u0067\u0065\u0074\u0020\u0074\u0068\u0065\u0020\u006e\u0075m\u0062\u0065\u0072\u0020\u006f\u0066\u0020P\u0061\u0067\u0065\u0073");
};_fba :=_fbfd ._dgb .FillColor ;_aaee :=_fbfd ._dgb .BorderWidth ;_cfef :=_fbfd ._dgb .FillOpacity ;for _ace :=1;_ace <=_cdc ;_ace ++{_cabe ,_fed :=_fbfd ._bfbe .GetPage (_ace );if _fed !=nil {return _fed ;};_fdef ,_fed :=_ee .New (_cabe );if _fed !=nil {return _fed ;
};_bce ,_ ,_ ,_fed :=_fdef .ExtractPageText ();if _fed !=nil {return _fed ;};_bda :=_bce .GetContentStreamOps ();_gae ,_agec ,_fed :=_fbfd .redactPage (_bda ,_cabe .Resources );if _agec ==nil {_gc .Log .Info ("N\u006f\u0020\u006d\u0061\u0074\u0063\u0068\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0066\u006f\u0072\u0020t\u0068\u0065\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065d \u0070\u0061\u0074t\u0061r\u006e\u002e");
_agec =_bda ;};_gbf :=_ab .ContentStreamOperation {Operand :"\u006e"};*_agec =append (*_agec ,&_gbf );_cabe .SetContentStreams ([]string {_agec .String ()},_gd .NewFlateEncoder ());if _fed !=nil {return _fed ;};_cba ,_fed :=_cabe .GetMediaBox ();if _fed !=nil {return _fed ;
};if _cabe .MediaBox ==nil {_cabe .MediaBox =_cba ;};if _gee :=_fbfd ._aebcg .AddPage (_cabe );_gee !=nil {return _gee ;};_ac .Slice (_gae ,func (_gddf ,_bab int )bool {return _gae [_gddf ]._fgb < _gae [_bab ]._fgb });_befe :=_cba .Ury ;for _ ,_bgd :=range _gae {_caab :=_bgd ._ccb ;
_gegfc :=_fbfd ._aebcg .NewRectangle (_caab .Llx ,_befe -_caab .Lly ,_caab .Urx -_caab .Llx ,-(_caab .Ury -_caab .Lly ));_gegfc .SetFillColor (_fba );_gegfc .SetBorderWidth (_aaee );_gegfc .SetFillOpacity (_cfef );if _bgdc :=_fbfd ._aebcg .Draw (_gegfc );
_bgdc !=nil {return nil ;};};};_fbfd ._aebcg .SetOutlineTree (_fbfd ._bfbe .GetOutlineTree ());return nil ;};func _cdf (_fa *_ab .ContentStreamOperations ,_gg string ,_fe int )error {_bf :=_ab .ContentStreamOperations {};var _cec _ab .ContentStreamOperation ;
for _fec ,_de :=range *_fa {if _fec ==_fe {if _gg =="\u0027"{_dee :=_ab .ContentStreamOperation {Operand :"\u0054\u002a"};_bf =append (_bf ,&_dee );_cec .Params =_de .Params ;_cec .Operand ="\u0054\u006a";_bf =append (_bf ,&_cec );}else if _gg =="\u0022"{_ddg :=_de .Params [:2];
Tc ,Tw :=_ddg [0],_ddg [1];_acg :=_ab .ContentStreamOperation {Params :[]_gd .PdfObject {Tc },Operand :"\u0054\u0063"};_bf =append (_bf ,&_acg );_acg =_ab .ContentStreamOperation {Params :[]_gd .PdfObject {Tw },Operand :"\u0054\u0077"};_bf =append (_bf ,&_acg );
_cec .Params =[]_gd .PdfObject {_de .Params [2]};_cec .Operand ="\u0054\u006a";_bf =append (_bf ,&_cec );};};_bf =append (_bf ,_de );};*_fa =_bf ;return nil ;};func _abf (_fea *_ee .TextMarkArray )(float64 ,error ){_ebd ,_aaf :=_fea .BBox ();if !_aaf {return 0.0,_g .Errorf ("\u0073\u0070\u0061\u006e\u004d\u0061\u0072\u006bs\u002e\u0042\u0042ox\u0020\u0068\u0061\u0073\u0020\u006eo\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062\u006f\u0078\u002e\u0020s\u0070\u0061\u006e\u004d\u0061\u0072\u006b\u0073=\u0025\u0073",_fea );
};_bgf :=_fb (_fea );_gab :=0.0;_ ,_dea :=_ba (_fea );_aab :=_fea .Elements ()[_dea ];_edd :=_aab .Font ;if _bgf > 0{_gab =_fd (_edd ,_aab );};_cefa :=(_ebd .Urx -_ebd .Llx );_cefa =_cefa +_gab *float64 (_bgf );Tj :=_dfaf (_cefa ,_aab .FontSize ,_aab .Th );
return Tj ,nil ;};func _accf (_cea string ,_baf *_da .PdfFont )[]byte {_ebf ,_bbg :=_baf .StringToCharcodeBytes (_cea );if _bbg !=0{_gc .Log .Debug ("\u0057\u0041\u0052\u004e\u003a\u0020\u0073\u006fm\u0065\u0020\u0072un\u0065\u0073\u0020\u0063\u006f\u0075l\u0064\u0020\u006e\u006f\u0074\u0020\u0062\u0065\u0020\u0065\u006e\u0063\u006f\u0064\u0065d\u002e\u000a\u0009\u0025\u0073\u0020\u002d\u003e \u0025\u0076",_cea ,_ebf );
};return _ebf ;};func _bead (_defe ,_geae targetMap )(bool ,[]int ){_gac :=_c .Contains (_defe ._aebcb ,_geae ._aebcb );var _abc []int ;for _ ,_cfge :=range _defe ._eccd {for _cffba ,_cggb :=range _geae ._eccd {if _cggb [0]>=_cfge [0]&&_cggb [1]<=_cfge [1]{_abc =append (_abc ,_cffba );
};};};return _gac ,_abc ;};func _ecc (_gdae *_ee .TextMarkArray )string {_fecg :="";for _ ,_afeb :=range _gdae .Elements (){_fecg +=_afeb .Text ;};return _fecg ;};type matchedIndex struct{_cccf int ;_dfb int ;_gde string ;};func _aed (_cdd *_ab .ContentStreamOperations ,_aedf map[_gd .PdfObject ][]localSpanMarks )error {for _dg ,_cg :=range _aedf {if _dg ==nil {continue ;
};_ca ,_fc ,_cc :=_fcc (_cdd ,_dg );if !_cc {_gc .Log .Debug ("Pd\u0066\u004fb\u006a\u0065\u0063\u0074\u0020\u0025\u0073\u006e\u006ft\u0020\u0066\u006f\u0075\u006e\u0064\u0020\u0069\u006e\u0020\u0073\u0069\u0064\u0065\u0020\u0074\u0068\u0065\u0020\u0063\u006f\u006e\u0074\u0065\u006e\u0074\u0073\u0074r\u0065a\u006d\u0020\u006f\u0070\u0065\u0072\u0061\u0074i\u006fn\u0020\u0025s",_dg ,_cdd );
return nil ;};if _ca .Operand =="\u0054\u006a"{_ffc :=_fde (_ca ,_dg ,_cg );if _ffc !=nil {return _ffc ;};}else if _ca .Operand =="\u0054\u004a"{_b :=_ecfe (_ca ,_dg ,_cg );if _b !=nil {return _b ;};}else if _ca .Operand =="\u0027"||_ca .Operand =="\u0022"{_dd :=_cdf (_cdd ,_ca .Operand ,_fc );
if _dd !=nil {return _dd ;};_dd =_fde (_ca ,_dg ,_cg );if _dd !=nil {return _dd ;};};};return nil ;};type matchedBBox struct{_ccb _da .PdfRectangle ;_fgb string ;};