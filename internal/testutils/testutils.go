//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_d "crypto/md5";_bef "encoding/hex";_ba "errors";_ea "fmt";_ac "github.com/unidoc/unipdf/v3/common";_adb "github.com/unidoc/unipdf/v3/core";_e "image";_be "image/png";_c "io";_ad "os";_bc "os/exec";_a "path/filepath";_b "strings";
_fd "testing";);func HashFile (file string )(string ,error ){_eg ,_egb :=_ad .Open (file );if _egb !=nil {return "",_egb ;};defer _eg .Close ();_ega :=_d .New ();if _ ,_egb =_c .Copy (_ega ,_eg );_egb !=nil {return "",_egb ;};return _bef .EncodeToString (_ega .Sum (nil )),nil ;
};var (ErrRenderNotSupported =_ba .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m");
);func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_efc :=_bc .LookPath ("\u0067\u0073");_efc !=nil {return ErrRenderNotSupported ;};return _bc .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_ea .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();
};func CopyFile (src ,dst string )error {_ec ,_bea :=_ad .Open (src );if _bea !=nil {return _bea ;};defer _ec .Close ();_ae ,_bea :=_ad .Create (dst );if _bea !=nil {return _bea ;};defer _ae .Close ();_ ,_bea =_c .Copy (_ae ,_ec );return _bea ;};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_ga ,_bd :=HashFile (file1 );
if _bd !=nil {return false ,_bd ;};_gad ,_bd :=HashFile (file2 );if _bd !=nil {return false ,_bd ;};if _ga ==_gad {return true ,nil ;};_da ,_bd :=ReadPNG (file1 );if _bd !=nil {return false ,_bd ;};_fe ,_bd :=ReadPNG (file2 );if _bd !=nil {return false ,_bd ;
};if _da .Bounds ()!=_fe .Bounds (){return false ,nil ;};return CompareImages (_da ,_fe );};func CompareImages (img1 ,img2 _e .Image )(bool ,error ){_g :=img1 .Bounds ();_fc :=0;for _ef :=0;_ef < _g .Size ().X ;_ef ++{for _db :=0;_db < _g .Size ().Y ;_db ++{_cf ,_cg ,_df ,_ :=img1 .At (_ef ,_db ).RGBA ();
_dg ,_beae ,_cfg ,_ :=img2 .At (_ef ,_db ).RGBA ();if _cf !=_dg ||_cg !=_beae ||_df !=_cfg {_fc ++;};};};_ff :=float64 (_fc )/float64 (_g .Dx ()*_g .Dy ());if _ff > 0.0001{_ea .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_ff ,_fc );
return false ,nil ;};return true ,nil ;};func ReadPNG (file string )(_e .Image ,error ){_af ,_ce :=_ad .Open (file );if _ce !=nil {return nil ,_ce ;};defer _af .Close ();return _be .Decode (_af );};func _de (_ged _adb .PdfObject ,_cfe map[int64 ]_adb .PdfObject )error {switch _cba :=_ged .(type ){case *_adb .PdfIndirectObject :_gec :=_cba ;
_de (_gec .PdfObject ,_cfe );case *_adb .PdfObjectDictionary :_cgb :=_cba ;for _ ,_efg :=range _cgb .Keys (){_gc :=_cgb .Get (_efg );if _eba ,_gg :=_gc .(*_adb .PdfObjectReference );_gg {_egd ,_gdg :=_cfe [_eba .ObjectNumber ];if !_gdg {return _ba .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_cgb .Set (_efg ,_egd );}else {_de (_gc ,_cfe );};};case *_adb .PdfObjectArray :_ee :=_cba ;for _acb ,_dbg :=range _ee .Elements (){if _eeg ,_fgc :=_dbg .(*_adb .PdfObjectReference );_fgc {_cd ,_feb :=_cfe [_eeg .ObjectNumber ];if !_feb {return _ba .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");
};_ee .Set (_acb ,_cd );}else {_de (_dbg ,_cfe );};};};return nil ;};func RunRenderTest (t *_fd .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_bg :=_b .TrimSuffix (_a .Base (pdfPath ),_a .Ext (pdfPath ));t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_bb *_fd .T ){_befg :=_a .Join (outputDir ,_bg );
_bbf :=_befg +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _eab :=RenderPDFToPNGs (pdfPath ,0,_bbf );_eab !=nil {_bb .Skip (_eab );};for _cc :=1;true ;_cc ++{_bce :=_ea .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_befg ,_cc );_dc :=_a .Join (baselineRenderPath ,_ea .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_bg ,_cc ));
if _ ,_dd :=_ad .Stat (_bce );_dd !=nil {break ;};_bb .Logf ("\u0025\u0073",_dc );if saveBaseline {_bb .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_bce ,_dc );_fcb :=CopyFile (_bce ,_dc );if _fcb !=nil {_bb .Fatalf ("\u0045\u0052\u0052OR\u0020\u0063\u006f\u0070\u0079\u0069\u006e\u0067\u0020\u0074\u006f\u0020\u0025\u0073\u003a\u0020\u0025\u0076",_dc ,_fcb );
};continue ;};_bb .Run (_ea .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_cc ),func (_ecc *_fd .T ){_ecc .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_bce ,_dc );_fcd ,_fde :=ComparePNGFiles (_bce ,_dc );
if _ad .IsNotExist (_fde ){_ecc .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_fcd {_ecc .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");
};});};});};func CompareDictionariesDeep (d1 ,d2 *_adb .PdfObjectDictionary )bool {if len (d1 .Keys ())!=len (d2 .Keys ()){_ac .Log .Debug ("\u0044\u0069\u0063\u0074\u0020\u0065\u006e\u0074\u0072\u0069\u0065\u0073\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",len (d1 .Keys ()),len (d2 .Keys ()));
_ac .Log .Debug ("\u0057\u0061s\u0020\u0027\u0025s\u0027\u0020\u0076\u0073\u0020\u0027\u0025\u0073\u0027",d1 .WriteString (),d2 .WriteString ());return false ;};for _ ,_dac :=range d1 .Keys (){if _dac =="\u0050\u0061\u0072\u0065\u006e\u0074"{continue ;
};_ggc :=_adb .TraceToDirectObject (d1 .Get (_dac ));_bcee :=_adb .TraceToDirectObject (d2 .Get (_dac ));if _ggc ==nil {_ac .Log .Debug ("\u00761\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};if _bcee ==nil {_ac .Log .Debug ("\u00762\u0020\u0069\u0073\u0020\u006e\u0069l");
return false ;};switch _gga :=_ggc .(type ){case *_adb .PdfObjectDictionary :_bbg ,_aca :=_bcee .(*_adb .PdfObjectDictionary );if !_aca {_ac .Log .Debug ("\u0054\u0079\u0070\u0065 m\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020\u0025\u0054\u0020\u0076\u0073\u0020%\u0054",_ggc ,_bcee );
return false ;};if !CompareDictionariesDeep (_gga ,_bbg ){return false ;};continue ;case *_adb .PdfObjectArray :_gda ,_fb :=_bcee .(*_adb .PdfObjectArray );if !_fb {_ac .Log .Debug ("\u00762\u0020n\u006f\u0074\u0020\u0061\u006e\u0020\u0061\u0072\u0072\u0061\u0079");
return false ;};if _gga .Len ()!=_gda .Len (){_ac .Log .Debug ("\u0061\u0072\u0072\u0061\u0079\u0020\u006c\u0065\u006e\u0067\u0074\u0068\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",_gga .Len (),_gda .Len ());
return false ;};for _eac :=0;_eac < _gga .Len ();_eac ++{_bf :=_adb .TraceToDirectObject (_gga .Get (_eac ));_egf :=_adb .TraceToDirectObject (_gda .Get (_eac ));if _ed ,_cdd :=_bf .(*_adb .PdfObjectDictionary );_cdd {_bab ,_feg :=_egf .(*_adb .PdfObjectDictionary );
if !_feg {return false ;};if !CompareDictionariesDeep (_ed ,_bab ){return false ;};}else {if _bf .WriteString ()!=_egf .WriteString (){_ac .Log .Debug ("M\u0069\u0073\u006d\u0061tc\u0068 \u0027\u0025\u0073\u0027\u0020!\u003d\u0020\u0027\u0025\u0073\u0027",_bf .WriteString (),_egf .WriteString ());
return false ;};};};continue ;};if _ggc .String ()!=_bcee .String (){_ac .Log .Debug ("\u006b\u0065y\u003d\u0025\u0073\u0020\u004d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0021\u0020\u0027\u0025\u0073\u0027\u0020\u0021\u003d\u0020'%\u0073\u0027",_dac ,_ggc .String (),_bcee .String ());
_ac .Log .Debug ("\u0046o\u0072 \u0027\u0025\u0054\u0027\u0020\u002d\u0020\u0027\u0025\u0054\u0027",_ggc ,_bcee );_ac .Log .Debug ("\u0046\u006f\u0072\u0020\u0027\u0025\u002b\u0076\u0027\u0020\u002d\u0020'\u0025\u002b\u0076\u0027",_ggc ,_bcee );return false ;
};};return true ;};func ParseIndirectObjects (rawpdf string )(map[int64 ]_adb .PdfObject ,error ){_aee :=_adb .NewParserFromString (rawpdf );_dbef :=map[int64 ]_adb .PdfObject {};for {_eb ,_ffc :=_aee .ParseIndirectObject ();if _ffc !=nil {if _ffc ==_c .EOF {break ;
};return nil ,_ffc ;};switch _acd :=_eb .(type ){case *_adb .PdfIndirectObject :_dbef [_acd .ObjectNumber ]=_eb ;case *_adb .PdfObjectStream :_dbef [_acd .ObjectNumber ]=_eb ;};};for _ ,_dda :=range _dbef {_de (_dda ,_dbef );};return _dbef ,nil ;};