//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package testutils ;import (_c "crypto/md5";_ec "encoding/hex";_fd "errors";_bb "fmt";_fg "github.com/unidoc/unipdf/v3/common";_d "github.com/unidoc/unipdf/v3/core";_ce "image";_cf "image/png";_ee "io";_gb "os";_g "os/exec";_a "path/filepath";_b "strings";_f "testing";);func CompareDictionariesDeep (d1 ,d2 *_d .PdfObjectDictionary )bool {if len (d1 .Keys ())!=len (d2 .Keys ()){_fg .Log .Debug ("\u0044\u0069\u0063\u0074\u0020\u0065\u006e\u0074\u0072\u0069\u0065\u0073\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",len (d1 .Keys ()),len (d2 .Keys ()));_fg .Log .Debug ("\u0057\u0061s\u0020\u0027\u0025s\u0027\u0020\u0076\u0073\u0020\u0027\u0025\u0073\u0027",d1 .WriteString (),d2 .WriteString ());return false ;};for _ ,_ffb :=range d1 .Keys (){if _ffb =="\u0050\u0061\u0072\u0065\u006e\u0074"{continue ;};_abe :=_d .TraceToDirectObject (d1 .Get (_ffb ));_cg :=_d .TraceToDirectObject (d2 .Get (_ffb ));if _abe ==nil {_fg .Log .Debug ("\u00761\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};if _cg ==nil {_fg .Log .Debug ("\u00762\u0020\u0069\u0073\u0020\u006e\u0069l");return false ;};switch _bbg :=_abe .(type ){case *_d .PdfObjectDictionary :_ggg ,_agg :=_cg .(*_d .PdfObjectDictionary );if !_agg {_fg .Log .Debug ("\u0054\u0079\u0070\u0065 m\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020\u0025\u0054\u0020\u0076\u0073\u0020%\u0054",_abe ,_cg );return false ;};if !CompareDictionariesDeep (_bbg ,_ggg ){return false ;};continue ;case *_d .PdfObjectArray :_bf ,_ged :=_cg .(*_d .PdfObjectArray );if !_ged {_fg .Log .Debug ("\u00762\u0020n\u006f\u0074\u0020\u0061\u006e\u0020\u0061\u0072\u0072\u0061\u0079");return false ;};if _bbg .Len ()!=_bf .Len (){_fg .Log .Debug ("\u0061\u0072\u0072\u0061\u0079\u0020\u006c\u0065\u006e\u0067\u0074\u0068\u0020\u006d\u0069s\u006da\u0074\u0063\u0068\u0020\u0028\u0025\u0064\u0020\u0021\u003d\u0020\u0025\u0064\u0029",_bbg .Len (),_bf .Len ());return false ;};for _aeg :=0;_aeg < _bbg .Len ();_aeg ++{_aee :=_d .TraceToDirectObject (_bbg .Get (_aeg ));_dbf :=_d .TraceToDirectObject (_bf .Get (_aeg ));if _bfa ,_aed :=_aee .(*_d .PdfObjectDictionary );_aed {_bdc ,_ggec :=_dbf .(*_d .PdfObjectDictionary );if !_ggec {return false ;};if !CompareDictionariesDeep (_bfa ,_bdc ){return false ;};}else {if _aee .WriteString ()!=_dbf .WriteString (){_fg .Log .Debug ("M\u0069\u0073\u006d\u0061tc\u0068 \u0027\u0025\u0073\u0027\u0020!\u003d\u0020\u0027\u0025\u0073\u0027",_aee .WriteString (),_dbf .WriteString ());return false ;};};};continue ;};if _abe .String ()!=_cg .String (){_fg .Log .Debug ("\u006b\u0065y\u003d\u0025\u0073\u0020\u004d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0021\u0020\u0027\u0025\u0073\u0027\u0020\u0021\u003d\u0020'%\u0073\u0027",_ffb ,_abe .String (),_cg .String ());_fg .Log .Debug ("\u0046o\u0072 \u0027\u0025\u0054\u0027\u0020\u002d\u0020\u0027\u0025\u0054\u0027",_abe ,_cg );_fg .Log .Debug ("\u0046\u006f\u0072\u0020\u0027\u0025\u002b\u0076\u0027\u0020\u002d\u0020'\u0025\u002b\u0076\u0027",_abe ,_cg );return false ;};};return true ;};func RenderPDFToPNGs (pdfPath string ,dpi int ,outpathTpl string )error {if dpi <=0{dpi =100;};if _ ,_dee :=_g .LookPath ("\u0067\u0073");_dee !=nil {return ErrRenderNotSupported ;};return _g .Command ("\u0067\u0073","\u002d\u0073\u0044\u0045\u0056\u0049\u0043\u0045\u003d\u0070\u006e\u0067a\u006c\u0070\u0068\u0061","\u002d\u006f",outpathTpl ,_bb .Sprintf ("\u002d\u0072\u0025\u0064",dpi ),pdfPath ).Run ();};func ComparePNGFiles (file1 ,file2 string )(bool ,error ){_ea ,_fa :=HashFile (file1 );if _fa !=nil {return false ,_fa ;};_fbff ,_fa :=HashFile (file2 );if _fa !=nil {return false ,_fa ;};if _ea ==_fbff {return true ,nil ;};_fag ,_fa :=ReadPNG (file1 );if _fa !=nil {return false ,_fa ;};_bd ,_fa :=ReadPNG (file2 );if _fa !=nil {return false ,_fa ;};if _fag .Bounds ()!=_bd .Bounds (){return false ,nil ;};return CompareImages (_fag ,_bd );};func CopyFile (src ,dst string )error {_bg ,_gf :=_gb .Open (src );if _gf !=nil {return _gf ;};defer _bg .Close ();_fc ,_gf :=_gb .Create (dst );if _gf !=nil {return _gf ;};defer _fc .Close ();_ ,_gf =_ee .Copy (_fc ,_bg );return _gf ;};func _ffd (_gge _d .PdfObject ,_gbc map[int64 ]_d .PdfObject )error {switch _ccc :=_gge .(type ){case *_d .PdfIndirectObject :_ggef :=_ccc ;_ffd (_ggef .PdfObject ,_gbc );case *_d .PdfObjectDictionary :_efd :=_ccc ;for _ ,_fe :=range _efd .Keys (){_be :=_efd .Get (_fe );if _adf ,_eacf :=_be .(*_d .PdfObjectReference );_eacf {_eae ,_dfd :=_gbc [_adf .ObjectNumber ];if !_dfd {return _fd .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");};_efd .Set (_fe ,_eae );}else {_ffd (_be ,_gbc );};};case *_d .PdfObjectArray :_dc :=_ccc ;for _db ,_abg :=range _dc .Elements (){if _ed ,_fdca :=_abg .(*_d .PdfObjectReference );_fdca {_ga ,_edd :=_gbc [_ed .ObjectNumber ];if !_edd {return _fd .New ("r\u0065\u0066\u0065\u0072\u0065\u006ec\u0065\u0020\u0074\u006f\u0020\u006f\u0075\u0074\u0073i\u0064\u0065\u0020o\u0062j\u0065\u0063\u0074");};_dc .Set (_db ,_ga );}else {_ffd (_abg ,_gbc );};};};return nil ;};func ParseIndirectObjects (rawpdf string )(map[int64 ]_d .PdfObject ,error ){_dff :=_d .NewParserFromString (rawpdf );_ddb :=map[int64 ]_d .PdfObject {};for {_gec ,_add :=_dff .ParseIndirectObject ();if _add !=nil {if _add ==_ee .EOF {break ;};return nil ,_add ;};switch _ac :=_gec .(type ){case *_d .PdfIndirectObject :_ddb [_ac .ObjectNumber ]=_gec ;case *_d .PdfObjectStream :_ddb [_ac .ObjectNumber ]=_gec ;};};for _ ,_ae :=range _ddb {_ffd (_ae ,_ddb );};return _ddb ,nil ;};func HashFile (file string )(string ,error ){_ag ,_eb :=_gb .Open (file );if _eb !=nil {return "",_eb ;};defer _ag .Close ();_eeb :=_c .New ();if _ ,_eb =_ee .Copy (_eeb ,_ag );_eb !=nil {return "",_eb ;};return _ec .EncodeToString (_eeb .Sum (nil )),nil ;};var (ErrRenderNotSupported =_fd .New ("\u0072\u0065\u006e\u0064\u0065r\u0069\u006e\u0067\u0020\u0050\u0044\u0046\u0020\u0066\u0069\u006c\u0065\u0073 \u0069\u0073\u0020\u006e\u006f\u0074\u0020\u0073\u0075\u0070\u0070\u006f\u0072\u0074\u0065\u0064\u0020\u006f\u006e\u0020\u0074\u0068\u0069\u0073\u0020\u0073\u0079\u0073\u0074\u0065m"););func RunRenderTest (t *_f .T ,pdfPath ,outputDir ,baselineRenderPath string ,saveBaseline bool ){_gee :=_b .TrimSuffix (_a .Base (pdfPath ),_a .Ext (pdfPath ));t .Run ("\u0072\u0065\u006e\u0064\u0065\u0072",func (_fba *_f .T ){_gg :=_a .Join (outputDir ,_gee );_eg :=_gg +"\u002d%\u0064\u002e\u0070\u006e\u0067";if _fcdb :=RenderPDFToPNGs (pdfPath ,0,_eg );_fcdb !=nil {_fba .Skip (_fcdb );};for _fdc :=1;true ;_fdc ++{_eec :=_bb .Sprintf ("\u0025s\u002d\u0025\u0064\u002e\u0070\u006eg",_gg ,_fdc );_bca :=_a .Join (baselineRenderPath ,_bb .Sprintf ("\u0025\u0073\u002d\u0025\u0064\u005f\u0065\u0078\u0070\u002e\u0070\u006e\u0067",_gee ,_fdc ));if _ ,_ff :=_gb .Stat (_eec );_ff !=nil {break ;};_fba .Logf ("\u0025\u0073",_bca );if _ ,_eac :=_gb .Stat (_bca );_gb .IsNotExist (_eac ){if saveBaseline {_fba .Logf ("\u0043\u006fp\u0079\u0069\u006eg\u0020\u0025\u0073\u0020\u002d\u003e\u0020\u0025\u0073",_eec ,_bca );CopyFile (_eec ,_bca );continue ;};break ;};_fba .Run (_bb .Sprintf ("\u0070\u0061\u0067\u0065\u0025\u0064",_fdc ),func (_efc *_f .T ){_efc .Logf ("\u0043o\u006dp\u0061\u0072\u0069\u006e\u0067 \u0025\u0073 \u0076\u0073\u0020\u0025\u0073",_eec ,_bca );_dg ,_ebc :=ComparePNGFiles (_eec ,_bca );if _gb .IsNotExist (_ebc ){_efc .Fatal ("\u0069m\u0061g\u0065\u0020\u0066\u0069\u006ce\u0020\u006di\u0073\u0073\u0069\u006e\u0067");}else if !_dg {_efc .Fatal ("\u0077\u0072\u006f\u006eg \u0070\u0061\u0067\u0065\u0020\u0072\u0065\u006e\u0064\u0065\u0072\u0065\u0064");};});};});};func ReadPNG (file string )(_ce .Image ,error ){_gfg ,_fb :=_gb .Open (file );if _fb !=nil {return nil ,_fb ;};defer _gfg .Close ();return _cf .Decode (_gfg );};func CompareImages (img1 ,img2 _ce .Image )(bool ,error ){_bc :=img1 .Bounds ();_af :=0;for _cc :=0;_cc < _bc .Size ().X ;_cc ++{for _ge :=0;_ge < _bc .Size ().Y ;_ge ++{_ad ,_ef ,_df ,_ :=img1 .At (_cc ,_ge ).RGBA ();_cbc ,_ca ,_fbf ,_ :=img2 .At (_cc ,_ge ).RGBA ();if _ad !=_cbc ||_ef !=_ca ||_df !=_fbf {_af ++;};};};_de :=float64 (_af )/float64 (_bc .Dx ()*_bc .Dy ());if _de > 0.0001{_bb .Printf ("\u0064\u0069\u0066f \u0066\u0072\u0061\u0063\u0074\u0069\u006f\u006e\u003a\u0020\u0025\u0076\u0020\u0028\u0025\u0064\u0029\u000a",_de ,_af );return false ,nil ;};return true ,nil ;};