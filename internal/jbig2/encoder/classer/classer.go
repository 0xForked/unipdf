//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package classer ;import (_b "github.com/unidoc/unipdf/v3/common";_a "github.com/unidoc/unipdf/v3/internal/jbig2/basic";_cf "github.com/unidoc/unipdf/v3/internal/jbig2/bitmap";_d "github.com/unidoc/unipdf/v3/internal/jbig2/errors";_g "image";_f "math";);const (MaxDiffWidth =2;MaxDiffHeight =2;);func Init (settings Settings )(*Classer ,error ){const _ga ="\u0063\u006c\u0061s\u0073\u0065\u0072\u002e\u0049\u006e\u0069\u0074";_e :=&Classer {Settings :settings ,Widths :map[int ]int {},Heights :map[int ]int {},TemplatesSize :_a .IntsMap {},TemplateAreas :&_a .IntSlice {},ComponentPageNumbers :&_a .IntSlice {},ClassIDs :&_a .IntSlice {},ComponentsNumber :&_a .IntSlice {},CentroidPoints :&_cf .Points {},CentroidPointsTemplates :&_cf .Points {},UndilatedTemplates :&_cf .Bitmaps {},DilatedTemplates :&_cf .Bitmaps {},ClassInstances :&_cf .BitmapsArray {},FgTemplates :&_a .NumSlice {}};if _ab :=_e .Settings .Validate ();_ab !=nil {return nil ,_d .Wrap (_ab ,_ga ,"");};return _e ,nil ;};type similarTemplatesFinder struct{Classer *Classer ;Width int ;Height int ;Index int ;CurrentNumbers []int ;N int ;};func (_adbg *Classer )verifyMethod (_gec Method )error {if _gec !=RankHaus &&_gec !=Correlation {return _d .Error ("\u0076\u0065\u0072i\u0066\u0079\u004d\u0065\u0074\u0068\u006f\u0064","\u0069\u006e\u0076\u0061li\u0064\u0020\u0063\u006c\u0061\u0073\u0073\u0065\u0072\u0020\u006d\u0065\u0074\u0068o\u0064");};return nil ;};func (_eeca Settings )Validate ()error {const _bbd ="\u0053\u0065\u0074\u0074\u0069\u006e\u0067\u0073\u002e\u0056\u0061\u006ci\u0064\u0061\u0074\u0065";if _eeca .Thresh < 0.4||_eeca .Thresh > 0.98{return _d .Error (_bbd ,"\u006a\u0062i\u0067\u0032\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0074\u0068\u0072\u0065\u0073\u0068\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0030\u002e\u0034\u0020\u002d\u0020\u0030\u002e\u0039\u0038\u005d");};if _eeca .WeightFactor < 0.0||_eeca .WeightFactor > 1.0{return _d .Error (_bbd ,"\u006a\u0062i\u0067\u0032\u0020\u0065\u006ec\u006f\u0064\u0065\u0072\u0020w\u0065\u0069\u0067\u0068\u0074\u0020\u0066\u0061\u0063\u0074\u006f\u0072\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0030\u002e\u0030\u0020\u002d\u0020\u0031\u002e\u0030\u005d");};if _eeca .RankHaus < 0.5||_eeca .RankHaus > 1.0{return _d .Error (_bbd ,"\u006a\u0062\u0069\u0067\u0032\u0020\u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0072a\u006e\u006b\u0020\u0068\u0061\u0075\u0073\u0020\u0076\u0061\u006c\u0075\u0065 \u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065 [\u0030\u002e\u0035\u0020\u002d\u0020\u0031\u002e\u0030\u005d");};if _eeca .SizeHaus < 1||_eeca .SizeHaus > 10{return _d .Error (_bbd ,"\u006a\u0062\u0069\u0067\u0032 \u0065\u006e\u0063\u006f\u0064\u0065\u0072\u0020\u0073\u0069\u007a\u0065\u0020h\u0061\u0075\u0073\u0020\u0076\u0061\u006c\u0075\u0065\u0020\u006e\u006f\u0074\u0020\u0069\u006e\u0020\u0072\u0061\u006e\u0067\u0065\u0020\u005b\u0031\u0020\u002d\u0020\u0031\u0030]");};switch _eeca .Components {case _cf .ComponentConn ,_cf .ComponentCharacters ,_cf .ComponentWords :default:return _d .Error (_bbd ,"\u0069n\u0076\u0061\u006c\u0069d\u0020\u0063\u006c\u0061\u0073s\u0065r\u0020c\u006f\u006d\u0070\u006f\u006e\u0065\u006et");};return nil ;};func DefaultSettings ()Settings {_dgf :=&Settings {};_dgf .SetDefault ();return *_dgf };const (RankHaus Method =iota ;Correlation ;);func (_bg *Classer )classifyRankHouseOne (_bga *_cf .Boxes ,_ccb ,_aff ,_dda *_cf .Bitmaps ,_gcd *_cf .Points ,_bce int )(_fee error ){const _caa ="\u0043\u006c\u0061\u0073s\u0065\u0072\u002e\u0063\u006c\u0061\u0073\u0073\u0069\u0066y\u0052a\u006e\u006b\u0048\u006f\u0075\u0073\u0065O\u006e\u0065";var (_dfa ,_fgf ,_gefa ,_bff float32 ;_cef int ;_aba ,_bbb ,_ba ,_ccd ,_cce *_cf .Bitmap ;_ddb ,_cbff bool ;);for _cccc :=0;_cccc < len (_ccb .Values );_cccc ++{_bbb =_aff .Values [_cccc ];_ba =_dda .Values [_cccc ];_dfa ,_fgf ,_fee =_gcd .GetGeometry (_cccc );if _fee !=nil {return _d .Wrapf (_fee ,_caa ,"\u0066\u0069\u0072\u0073\u0074\u0020\u0067\u0065\u006fm\u0065\u0074\u0072\u0079");};_deb :=len (_bg .UndilatedTemplates .Values );_ddb =false ;_cbfc :=_deee (_bg ,_bbb );for _cef =_cbfc .Next ();_cef > -1;{_ccd ,_fee =_bg .UndilatedTemplates .GetBitmap (_cef );if _fee !=nil {return _d .Wrap (_fee ,_caa ,"\u0062\u006d\u0033");};_cce ,_fee =_bg .DilatedTemplates .GetBitmap (_cef );if _fee !=nil {return _d .Wrap (_fee ,_caa ,"\u0062\u006d\u0034");};_gefa ,_bff ,_fee =_bg .CentroidPointsTemplates .GetGeometry (_cef );if _fee !=nil {return _d .Wrap (_fee ,_caa ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0054\u0065\u006d\u0070l\u0061\u0074\u0065\u0073");};_cbff ,_fee =_cf .HausTest (_bbb ,_ba ,_ccd ,_cce ,_dfa -_gefa ,_fgf -_bff ,MaxDiffWidth ,MaxDiffHeight );if _fee !=nil {return _d .Wrap (_fee ,_caa ,"");};if _cbff {_ddb =true ;if _fee =_bg .ClassIDs .Add (_cef );_fee !=nil {return _d .Wrap (_fee ,_caa ,"");};if _fee =_bg .ComponentPageNumbers .Add (_bce );_fee !=nil {return _d .Wrap (_fee ,_caa ,"");};if _bg .Settings .KeepClassInstances {_fccf ,_aefb :=_bg .ClassInstances .GetBitmaps (_cef );if _aefb !=nil {return _d .Wrap (_aefb ,_caa ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");};_aba ,_aefb =_ccb .GetBitmap (_cccc );if _aefb !=nil {return _d .Wrap (_aefb ,_caa ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");};_fccf .AddBitmap (_aba );_ced ,_aefb :=_bga .Get (_cccc );if _aefb !=nil {return _d .Wrap (_aefb ,_caa ,"\u004be\u0065\u0070\u0050\u0069\u0078\u0061a");};_fccf .AddBox (_ced );};break ;};};if !_ddb {if _fee =_bg .ClassIDs .Add (_deb );_fee !=nil {return _d .Wrap (_fee ,_caa ,"");};if _fee =_bg .ComponentPageNumbers .Add (_bce );_fee !=nil {return _d .Wrap (_fee ,_caa ,"");};_gde :=&_cf .Bitmaps {};_aba ,_fee =_ccb .GetBitmap (_cccc );if _fee !=nil {return _d .Wrap (_fee ,_caa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_gde .Values =append (_gde .Values ,_aba );_ggc ,_cgd :=_aba .Width ,_aba .Height ;_bg .TemplatesSize .Add (uint64 (_cgd )*uint64 (_ggc ),_deb );_eeb ,_efb :=_bga .Get (_cccc );if _efb !=nil {return _d .Wrap (_efb ,_caa ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_gde .AddBox (_eeb );_bg .ClassInstances .AddBitmaps (_gde );_bg .CentroidPointsTemplates .AddPoint (_dfa ,_fgf );_bg .UndilatedTemplates .AddBitmap (_bbb );_bg .DilatedTemplates .AddBitmap (_ba );};};return nil ;};func (_ccfd *Classer )classifyRankHouseNonOne (_eag *_cf .Boxes ,_edae ,_bgb ,_ceg *_cf .Bitmaps ,_cedb *_cf .Points ,_eaf *_a .NumSlice ,_fec int )(_fdf error ){const _gdd ="\u0043\u006c\u0061\u0073s\u0065\u0072\u002e\u0063\u006c\u0061\u0073\u0073\u0069\u0066y\u0052a\u006e\u006b\u0048\u006f\u0075\u0073\u0065O\u006e\u0065";var (_ddf ,_bcg ,_fcg ,_aaa float32 ;_aaag ,_adgd ,_eagf int ;_abg ,_cbc ,_cca ,_dgab ,_gdb *_cf .Bitmap ;_eee ,_eeg bool ;);_dcc :=_cf .MakePixelSumTab8 ();for _ffe :=0;_ffe < len (_edae .Values );_ffe ++{if _cbc ,_fdf =_bgb .GetBitmap (_ffe );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"b\u006d\u0073\u0031\u002e\u0047\u0065\u0074\u0028\u0069\u0029");};if _aaag ,_fdf =_eaf .GetInt (_ffe );_fdf !=nil {_b .Log .Trace ("\u0047\u0065t\u0074\u0069\u006e\u0067 \u0046\u0047T\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073 \u0061\u0074\u003a\u0020\u0025\u0064\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_ffe ,_fdf );};if _cca ,_fdf =_ceg .GetBitmap (_ffe );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"b\u006d\u0073\u0032\u002e\u0047\u0065\u0074\u0028\u0069\u0029");};if _ddf ,_bcg ,_fdf =_cedb .GetGeometry (_ffe );_fdf !=nil {return _d .Wrapf (_fdf ,_gdd ,"\u0070t\u0061[\u0069\u005d\u002e\u0047\u0065\u006f\u006d\u0065\u0074\u0072\u0079");};_add :=len (_ccfd .UndilatedTemplates .Values );_eee =false ;_afc :=_deee (_ccfd ,_cbc );for _eagf =_afc .Next ();_eagf > -1;{if _dgab ,_fdf =_ccfd .UndilatedTemplates .GetBitmap (_eagf );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"\u0070\u0069\u0078\u0061\u0074\u002e\u005b\u0069\u0043l\u0061\u0073\u0073\u005d");};if _adgd ,_fdf =_ccfd .FgTemplates .GetInt (_eagf );_fdf !=nil {_b .Log .Trace ("\u0047\u0065\u0074\u0074\u0069\u006eg\u0020\u0046\u0047\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u005b\u0025d\u005d\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_eagf ,_fdf );};if _gdb ,_fdf =_ccfd .DilatedTemplates .GetBitmap (_eagf );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"\u0070\u0069\u0078\u0061\u0074\u0064\u005b\u0069\u0043l\u0061\u0073\u0073\u005d");};if _fcg ,_aaa ,_fdf =_ccfd .CentroidPointsTemplates .GetGeometry (_eagf );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"\u0043\u0065\u006et\u0072\u006f\u0069\u0064P\u006f\u0069\u006e\u0074\u0073\u0054\u0065m\u0070\u006c\u0061\u0074\u0065\u0073\u005b\u0069\u0043\u006c\u0061\u0073\u0073\u005d");};_eeg ,_fdf =_cf .RankHausTest (_cbc ,_cca ,_dgab ,_gdb ,_ddf -_fcg ,_bcg -_aaa ,MaxDiffWidth ,MaxDiffHeight ,_aaag ,_adgd ,float32 (_ccfd .Settings .RankHaus ),_dcc );if _fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"");};if _eeg {_eee =true ;if _fdf =_ccfd .ClassIDs .Add (_eagf );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"");};if _fdf =_ccfd .ComponentPageNumbers .Add (_fec );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"");};if _ccfd .Settings .KeepClassInstances {_cde ,_baa :=_ccfd .ClassInstances .GetBitmaps (_eagf );if _baa !=nil {return _d .Wrap (_baa ,_gdd ,"\u0063\u002e\u0050\u0069\u0078\u0061\u0061\u002e\u0047\u0065\u0074B\u0069\u0074\u006d\u0061\u0070\u0073\u0028\u0069\u0043\u006ca\u0073\u0073\u0029");};if _abg ,_baa =_edae .GetBitmap (_ffe );_baa !=nil {return _d .Wrap (_baa ,_gdd ,"\u0070i\u0078\u0061\u005b\u0069\u005d");};_cde .Values =append (_cde .Values ,_abg );_ebd ,_baa :=_eag .Get (_ffe );if _baa !=nil {return _d .Wrap (_baa ,_gdd ,"b\u006f\u0078\u0061\u002e\u0047\u0065\u0074\u0028\u0069\u0029");};_cde .Boxes =append (_cde .Boxes ,_ebd );};break ;};};if !_eee {if _fdf =_ccfd .ClassIDs .Add (_add );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"\u0021\u0066\u006f\u0075\u006e\u0064");};if _fdf =_ccfd .ComponentPageNumbers .Add (_fec );_fdf !=nil {return _d .Wrap (_fdf ,_gdd ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_aga :=&_cf .Bitmaps {};_abg =_edae .Values [_ffe ];_aga .AddBitmap (_abg );_gfe ,_aag :=_abg .Width ,_abg .Height ;_ccfd .TemplatesSize .Add (uint64 (_gfe )*uint64 (_aag ),_add );_bef ,_afb :=_eag .Get (_ffe );if _afb !=nil {return _d .Wrap (_afb ,_gdd ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_aga .AddBox (_bef );_ccfd .ClassInstances .AddBitmaps (_aga );_ccfd .CentroidPointsTemplates .AddPoint (_ddf ,_bcg );_ccfd .UndilatedTemplates .AddBitmap (_cbc );_ccfd .DilatedTemplates .AddBitmap (_cca );_ccfd .FgTemplates .AddInt (_aaag );};};_ccfd .NumberOfClasses =len (_ccfd .UndilatedTemplates .Values );return nil ;};func (_gf *Classer )addPageComponents (_fg *_cf .Bitmap ,_db *_cf .Boxes ,_ff *_cf .Bitmaps ,_bf int ,_aa Method )error {const _fce ="\u0043l\u0061\u0073\u0073\u0065r\u002e\u0041\u0064\u0064\u0050a\u0067e\u0043o\u006d\u0070\u006f\u006e\u0065\u006e\u0074s";if _fg ==nil {return _d .Error (_fce ,"\u006e\u0069\u006c\u0020\u0069\u006e\u0070\u0075\u0074 \u0070\u0061\u0067\u0065");};if _db ==nil ||_ff ==nil ||len (*_db )==0{_b .Log .Trace ("\u0041\u0064\u0064P\u0061\u0067\u0065\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u003a\u0020\u0025\u0073\u002e\u0020\u004e\u006f\u0020\u0063\u006f\u006d\u0070\u006f\u006e\u0065n\u0074\u0073\u0020\u0066\u006f\u0075\u006e\u0064",_fg );return nil ;};var _cfg error ;switch _aa {case RankHaus :_cfg =_gf .classifyRankHaus (_db ,_ff ,_bf );case Correlation :_cfg =_gf .classifyCorrelation (_db ,_ff ,_bf );default:_b .Log .Debug ("\u0055\u006ek\u006e\u006f\u0077\u006e\u0020\u0063\u006c\u0061\u0073\u0073\u0069\u0066\u0079\u0020\u006d\u0065\u0074\u0068\u006f\u0064\u003a\u0020'%\u0076\u0027",_aa );return _d .Error (_fce ,"\u0075\u006e\u006bno\u0077\u006e\u0020\u0063\u006c\u0061\u0073\u0073\u0069\u0066\u0079\u0020\u006d\u0065\u0074\u0068\u006f\u0064");};if _cfg !=nil {return _d .Wrap (_cfg ,_fce ,"");};if _cfg =_gf .getULCorners (_fg ,_db );_cfg !=nil {return _d .Wrap (_cfg ,_fce ,"");};_abe :=len (*_db );_gf .BaseIndex +=_abe ;if _cfg =_gf .ComponentsNumber .Add (_abe );_cfg !=nil {return _d .Wrap (_cfg ,_fce ,"");};return nil ;};var TwoByTwoWalk =[]int {0,0,0,1,-1,0,0,-1,1,0,-1,1,1,1,-1,-1,1,-1,0,-2,2,0,0,2,-2,0,-1,-2,1,-2,2,-1,2,1,1,2,-1,2,-2,1,-2,-1,-2,-2,2,-2,2,2,-2,2};func (_gb *Classer )AddPage (inputPage *_cf .Bitmap ,pageNumber int ,method Method )(_cc error ){const _cd ="\u0043l\u0061s\u0073\u0065\u0072\u002e\u0041\u0064\u0064\u0050\u0061\u0067\u0065";_gb .Widths [pageNumber ]=inputPage .Width ;_gb .Heights [pageNumber ]=inputPage .Height ;if _cc =_gb .verifyMethod (method );_cc !=nil {return _d .Wrap (_cc ,_cd ,"");};_fa ,_ec ,_cc :=inputPage .GetComponents (_gb .Settings .Components ,_gb .Settings .MaxCompWidth ,_gb .Settings .MaxCompHeight );if _cc !=nil {return _d .Wrap (_cc ,_cd ,"");};_b .Log .Debug ("\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074s\u003a\u0020\u0025\u0076",_fa );if _cc =_gb .addPageComponents (inputPage ,_ec ,_fa ,pageNumber ,method );_cc !=nil {return _d .Wrap (_cc ,_cd ,"");};return nil ;};func _deee (_ega *Classer ,_dccd *_cf .Bitmap )*similarTemplatesFinder {return &similarTemplatesFinder {Width :_dccd .Width ,Height :_dccd .Height ,Classer :_ega };};func (_de *Classer )getULCorners (_ad *_cf .Bitmap ,_ef *_cf .Boxes )error {const _ee ="\u0067\u0065\u0074U\u004c\u0043\u006f\u0072\u006e\u0065\u0072\u0073";if _ad ==nil {return _d .Error (_ee ,"\u006e\u0069l\u0020\u0069\u006da\u0067\u0065\u0020\u0062\u0069\u0074\u006d\u0061\u0070");};if _ef ==nil {return _d .Error (_ee ,"\u006e\u0069\u006c\u0020\u0062\u006f\u0075\u006e\u0064\u0073");};if _de .PtaUL ==nil {_de .PtaUL =&_cf .Points {};};_ag :=len (*_ef );var (_dee ,_ecc ,_eb ,_ge int ;_cfd ,_eef ,_bfd ,_cea float32 ;_adg error ;_fe *_g .Rectangle ;_gbg *_cf .Bitmap ;_gfc _g .Point ;);for _fac :=0;_fac < _ag ;_fac ++{_dee =_de .BaseIndex +_fac ;if _cfd ,_eef ,_adg =_de .CentroidPoints .GetGeometry (_dee );_adg !=nil {return _d .Wrap (_adg ,_ee ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0050o\u0069\u006e\u0074\u0073");};if _ecc ,_adg =_de .ClassIDs .Get (_dee );_adg !=nil {return _d .Wrap (_adg ,_ee ,"\u0043\u006c\u0061s\u0073\u0049\u0044\u0073\u002e\u0047\u0065\u0074");};if _bfd ,_cea ,_adg =_de .CentroidPointsTemplates .GetGeometry (_ecc );_adg !=nil {return _d .Wrap (_adg ,_ee ,"\u0043\u0065\u006etr\u006f\u0069\u0064\u0050\u006f\u0069\u006e\u0074\u0073\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073");};_ca :=_bfd -_cfd ;_cbf :=_cea -_eef ;if _ca >=0{_eb =int (_ca +0.5);}else {_eb =int (_ca -0.5);};if _cbf >=0{_ge =int (_cbf +0.5);}else {_ge =int (_cbf -0.5);};if _fe ,_adg =_ef .Get (_fac );_adg !=nil {return _d .Wrap (_adg ,_ee ,"");};_aeb ,_adb :=_fe .Min .X ,_fe .Min .Y ;_gbg ,_adg =_de .UndilatedTemplates .GetBitmap (_ecc );if _adg !=nil {return _d .Wrap (_adg ,_ee ,"\u0055\u006e\u0064\u0069\u006c\u0061\u0074\u0065\u0064\u0054e\u006d\u0070\u006c\u0061\u0074\u0065\u0073.\u0047\u0065\u0074\u0028\u0069\u0043\u006c\u0061\u0073\u0073\u0029");};_gfc ,_adg =_ggb (_ad ,_aeb ,_adb ,_eb ,_ge ,_gbg );if _adg !=nil {return _d .Wrap (_adg ,_ee ,"");};_de .PtaUL .AddPoint (float32 (_aeb -_eb +_gfc .X ),float32 (_adb -_ge +_gfc .Y ));};return nil ;};func _ggb (_feb *_cf .Bitmap ,_ece ,_aec ,_bfg ,_faca int ,_bb *_cf .Bitmap )(_gd _g .Point ,_agc error ){const _gbf ="\u0066i\u006e\u0061\u006c\u0041l\u0069\u0067\u006e\u006d\u0065n\u0074P\u006fs\u0069\u0074\u0069\u006f\u006e\u0069\u006eg";if _feb ==nil {return _gd ,_d .Error (_gbf ,"\u0073\u006f\u0075\u0072ce\u0020\u006e\u006f\u0074\u0020\u0070\u0072\u006f\u0076\u0069\u0064\u0065\u0064");};if _bb ==nil {return _gd ,_d .Error (_gbf ,"t\u0065\u006d\u0070\u006cat\u0065 \u006e\u006f\u0074\u0020\u0070r\u006f\u0076\u0069\u0064\u0065\u0064");};_df ,_eg :=_bb .Width ,_bb .Height ;_eec ,_egf :=_ece -_bfg -JbAddedPixels ,_aec -_faca -JbAddedPixels ;_b .Log .Trace ("\u0078\u003a\u0020\u0027\u0025\u0064\u0027\u002c\u0020\u0079\u003a\u0020\u0027\u0025\u0064'\u002c\u0020\u0077\u003a\u0020\u0027\u0025\u0064\u0027\u002c\u0020\u0068\u003a \u0027\u0025\u0064\u0027\u002c\u0020\u0062\u0078\u003a\u0020\u0027\u0025d'\u002c\u0020\u0062\u0079\u003a\u0020\u0027\u0025\u0064\u0027",_ece ,_aec ,_df ,_eg ,_eec ,_egf );_aaf ,_agc :=_cf .Rect (_eec ,_egf ,_df ,_eg );if _agc !=nil {return _gd ,_d .Wrap (_agc ,_gbf ,"");};_dc ,_ ,_agc :=_feb .ClipRectangle (_aaf );if _agc !=nil {_b .Log .Error ("\u0043a\u006e\u0027\u0074\u0020\u0063\u006c\u0069\u0070\u0020\u0072\u0065c\u0074\u0061\u006e\u0067\u006c\u0065\u003a\u0020\u0025\u0076",_aaf );return _gd ,_d .Wrap (_agc ,_gbf ,"");};_cfdg :=_cf .New (_dc .Width ,_dc .Height );_efe :=_f .MaxInt32 ;var _dca ,_aea ,_faf ,_eed ,_bc int ;for _dca =-1;_dca <=1;_dca ++{for _aea =-1;_aea <=1;_aea ++{if _ ,_agc =_cf .Copy (_cfdg ,_dc );_agc !=nil {return _gd ,_d .Wrap (_agc ,_gbf ,"");};if _agc =_cfdg .RasterOperation (_aea ,_dca ,_df ,_eg ,_cf .PixSrcXorDst ,_bb ,0,0);_agc !=nil {return _gd ,_d .Wrap (_agc ,_gbf ,"");};_faf =_cfdg .CountPixels ();if _faf < _efe {_eed =_aea ;_bc =_dca ;_efe =_faf ;};};};_gd .X =_eed ;_gd .Y =_bc ;return _gd ,nil ;};const JbAddedPixels =6;func (_ffeb *similarTemplatesFinder )Next ()int {var (_bfff ,_ffc ,_caf ,_adgdg int ;_ecg bool ;_gfeg *_cf .Bitmap ;_aad error ;);for {if _ffeb .Index >=25{return -1;};_ffc =_ffeb .Width +TwoByTwoWalk [2*_ffeb .Index ];_bfff =_ffeb .Height +TwoByTwoWalk [2*_ffeb .Index +1];if _bfff < 1||_ffc < 1{_ffeb .Index ++;continue ;};if len (_ffeb .CurrentNumbers )==0{_ffeb .CurrentNumbers ,_ecg =_ffeb .Classer .TemplatesSize .GetSlice (uint64 (_ffc )*uint64 (_bfff ));if !_ecg {_ffeb .Index ++;continue ;};_ffeb .N =0;};_caf =len (_ffeb .CurrentNumbers );for ;_ffeb .N < _caf ;_ffeb .N ++{_adgdg =_ffeb .CurrentNumbers [_ffeb .N ];_gfeg ,_aad =_ffeb .Classer .DilatedTemplates .GetBitmap (_adgdg );if _aad !=nil {_b .Log .Debug ("\u0046\u0069\u006e\u0064\u004e\u0065\u0078\u0074\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u003a\u0020\u0074\u0065\u006d\u0070\u006c\u0061t\u0065\u0020\u006e\u006f\u0074 \u0066\u006fu\u006e\u0064\u003a\u0020");return 0;};if _gfeg .Width -2*JbAddedPixels ==_ffc &&_gfeg .Height -2*JbAddedPixels ==_bfff {return _adgdg ;};};_ffeb .Index ++;_ffeb .CurrentNumbers =nil ;};};type Method int ;type Settings struct{MaxCompWidth int ;MaxCompHeight int ;SizeHaus int ;RankHaus float64 ;Thresh float64 ;WeightFactor float64 ;KeepClassInstances bool ;Components _cf .Component ;Method Method ;};var _ebf bool ;const (MaxConnCompWidth =350;MaxCharCompWidth =350;MaxWordCompWidth =1000;MaxCompHeight =120;);type Classer struct{BaseIndex int ;Settings Settings ;ComponentsNumber *_a .IntSlice ;TemplateAreas *_a .IntSlice ;Widths map[int ]int ;Heights map[int ]int ;NumberOfClasses int ;ClassInstances *_cf .BitmapsArray ;UndilatedTemplates *_cf .Bitmaps ;DilatedTemplates *_cf .Bitmaps ;TemplatesSize _a .IntsMap ;FgTemplates *_a .NumSlice ;CentroidPoints *_cf .Points ;CentroidPointsTemplates *_cf .Points ;ClassIDs *_a .IntSlice ;ComponentPageNumbers *_a .IntSlice ;PtaUL *_cf .Points ;PtaLL *_cf .Points ;};func (_fd *Classer )ComputeLLCorners ()(_fc error ){const _ae ="\u0043l\u0061\u0073\u0073\u0065\u0072\u002e\u0043\u006f\u006d\u0070\u0075t\u0065\u004c\u004c\u0043\u006f\u0072\u006e\u0065\u0072\u0073";if _fd .PtaUL ==nil {return _d .Error (_ae ,"\u0055\u004c\u0020\u0043or\u006e\u0065\u0072\u0073\u0020\u006e\u006f\u0074\u0020\u0064\u0065\u0066\u0069\u006ee\u0064");};_ed :=len (*_fd .PtaUL );_fd .PtaLL =&_cf .Points {};var (_ce ,_cfc float32 ;_gg ,_cb int ;_gc *_cf .Bitmap ;);for _cg :=0;_cg < _ed ;_cg ++{_ce ,_cfc ,_fc =_fd .PtaUL .GetGeometry (_cg );if _fc !=nil {_b .Log .Debug ("\u0047e\u0074\u0074\u0069\u006e\u0067\u0020\u0050\u0074\u0061\u0055\u004c \u0066\u0061\u0069\u006c\u0065\u0064\u003a\u0020\u0025\u0076",_fc );return _d .Wrap (_fc ,_ae ,"\u0050\u0074\u0061\u0055\u004c\u0020\u0047\u0065\u006fm\u0065\u0074\u0072\u0079");};_gg ,_fc =_fd .ClassIDs .Get (_cg );if _fc !=nil {_b .Log .Debug ("\u0047\u0065\u0074\u0074\u0069\u006e\u0067\u0020\u0043\u006c\u0061s\u0073\u0049\u0044\u0020\u0066\u0061\u0069\u006c\u0065\u0064:\u0020\u0025\u0076",_fc );return _d .Wrap (_fc ,_ae ,"\u0043l\u0061\u0073\u0073\u0049\u0044");};_gc ,_fc =_fd .UndilatedTemplates .GetBitmap (_gg );if _fc !=nil {_b .Log .Debug ("\u0047\u0065t\u0074\u0069\u006e\u0067 \u0055\u006ed\u0069\u006c\u0061\u0074\u0065\u0064\u0054\u0065m\u0070\u006c\u0061\u0074\u0065\u0073\u0020\u0066\u0061\u0069\u006c\u0065d\u003a\u0020\u0025\u0076",_fc );return _d .Wrap (_fc ,_ae ,"\u0055\u006e\u0064\u0069la\u0074\u0065\u0064\u0020\u0054\u0065\u006d\u0070\u006c\u0061\u0074\u0065\u0073");};_cb =_gc .Height ;_fd .PtaLL .AddPoint (_ce ,_cfc +float32 (_cb ));};return nil ;};func (_aef *Classer )classifyCorrelation (_gfa *_cf .Boxes ,_aee *_cf .Bitmaps ,_ea int )error {const _cgb ="\u0063\u006c\u0061\u0073si\u0066\u0079\u0043\u006f\u0072\u0072\u0065\u006c\u0061\u0074\u0069\u006f\u006e";if _gfa ==nil {return _d .Error (_cgb ,"\u006e\u0065\u0077\u0043\u006f\u006d\u0070\u006f\u006e\u0065\u006e\u0074\u0073\u0020\u0062\u006f\u0075\u006e\u0064\u0069\u006e\u0067\u0020\u0062o\u0078\u0065\u0073\u0020\u006eo\u0074\u0020f\u006f\u0075\u006e\u0064");};if _aee ==nil {return _d .Error (_cgb ,"\u006e\u0065wC\u006f\u006d\u0070o\u006e\u0065\u006e\u0074s b\u0069tm\u0061\u0070\u0020\u0061\u0072\u0072\u0061y \u006e\u006f\u0074\u0020\u0066\u006f\u0075n\u0064");};_eab :=len (_aee .Values );if _eab ==0{_b .Log .Debug ("\u0063l\u0061\u0073s\u0069\u0066\u0079C\u006f\u0072\u0072\u0065\u006c\u0061\u0074i\u006f\u006e\u0020\u002d\u0020\u0070r\u006f\u0076\u0069\u0064\u0065\u0064\u0020\u0070\u0069\u0078\u0061s\u0020\u0069\u0073\u0020\u0065\u006d\u0070\u0074\u0079");return nil ;};var (_gef ,_dce *_cf .Bitmap ;_adbe error ;);_egb :=&_cf .Bitmaps {Values :make ([]*_cf .Bitmap ,_eab )};for _feg ,_cff :=range _aee .Values {_dce ,_adbe =_cff .AddBorderGeneral (JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,0);if _adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"");};_egb .Values [_feg ]=_dce ;};_edd :=_aef .FgTemplates ;_gbfg :=_cf .MakePixelSumTab8 ();_dbf :=_cf .MakePixelCentroidTab8 ();_gga :=make ([]int ,_eab );_eaa :=make ([][]int ,_eab );_bd :=_cf .Points (make ([]_cf .Point ,_eab ));_fb :=&_bd ;var (_eea ,_dcg int ;_fea ,_bfa ,_fgg int ;_dg ,_dge int ;_cga byte ;);for _agcf ,_abb :=range _egb .Values {_eaa [_agcf ]=make ([]int ,_abb .Height );_eea =0;_dcg =0;_bfa =(_abb .Height -1)*_abb .RowStride ;_fea =0;for _dge =_abb .Height -1;_dge >=0;_dge ,_bfa =_dge -1,_bfa -_abb .RowStride {_eaa [_agcf ][_dge ]=_fea ;_fgg =0;for _dg =0;_dg < _abb .RowStride ;_dg ++{_cga =_abb .Data [_bfa +_dg ];_fgg +=_gbfg [_cga ];_eea +=_dbf [_cga ]+_dg *8*_gbfg [_cga ];};_fea +=_fgg ;_dcg +=_fgg *_dge ;};_gga [_agcf ]=_fea ;if _fea > 0{(*_fb )[_agcf ]=_cf .Point {X :float32 (_eea )/float32 (_fea ),Y :float32 (_dcg )/float32 (_fea )};}else {(*_fb )[_agcf ]=_cf .Point {X :float32 (_abb .Width )/float32 (2),Y :float32 (_abb .Height )/float32 (2)};};};if _adbe =_aef .CentroidPoints .Add (_fb );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0063\u0065\u006et\u0072\u006f\u0069\u0064\u0020\u0061\u0064\u0064");};var (_fda ,_aeba ,_dga int ;_af float64 ;_fbe ,_febd ,_abbd ,_fga float32 ;_da ,_egg _cf .Point ;_fcb bool ;_ged *similarTemplatesFinder ;_bbe int ;_gfb *_cf .Bitmap ;_gecg *_g .Rectangle ;_facb *_cf .Bitmaps ;);for _bbe ,_dce =range _egb .Values {_aeba =_gga [_bbe ];if _fbe ,_febd ,_adbe =_fb .GetGeometry (_bbe );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0070t\u0061\u0020\u002d\u0020\u0069");};_fcb =false ;_ac :=len (_aef .UndilatedTemplates .Values );_ged =_deee (_aef ,_dce );for _ebfe :=_ged .Next ();_ebfe > -1;{if _gfb ,_adbe =_aef .UndilatedTemplates .GetBitmap (_ebfe );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0075\u006e\u0069dl\u0061\u0074\u0065\u0064\u005b\u0069\u0063\u006c\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u0062\u006d\u0032");};if _dga ,_adbe =_edd .GetInt (_ebfe );_adbe !=nil {_b .Log .Trace ("\u0046\u0047\u0020T\u0065\u006d\u0070\u006ca\u0074\u0065\u0020\u005b\u0069\u0063\u006ca\u0073\u0073\u005d\u0020\u0066\u0061\u0069\u006c\u0065\u0064\u003a\u0020\u0025\u0076",_adbe );};if _abbd ,_fga ,_adbe =_aef .CentroidPointsTemplates .GetGeometry (_ebfe );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0043\u0065\u006e\u0074\u0072\u006f\u0069\u0064\u0050\u006f\u0069\u006e\u0074T\u0065\u006d\u0070\u006c\u0061\u0074e\u0073\u005b\u0069\u0063\u006c\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u00782\u002c\u0079\u0032\u0020");};if _aef .Settings .WeightFactor > 0.0{if _fda ,_adbe =_aef .TemplateAreas .Get (_ebfe );_adbe !=nil {_b .Log .Trace ("\u0054\u0065\u006dp\u006c\u0061\u0074\u0065A\u0072\u0065\u0061\u0073\u005b\u0069\u0063l\u0061\u0073\u0073\u005d\u0020\u003d\u0020\u0061\u0072\u0065\u0061\u0020\u0025\u0076",_adbe );};_af =_aef .Settings .Thresh +(1.0-_aef .Settings .Thresh )*_aef .Settings .WeightFactor *float64 (_dga )/float64 (_fda );}else {_af =_aef .Settings .Thresh ;};_bda ,_bfdf :=_cf .CorrelationScoreThresholded (_dce ,_gfb ,_aeba ,_dga ,_da .X -_egg .X ,_da .Y -_egg .Y ,MaxDiffWidth ,MaxDiffHeight ,_gbfg ,_eaa [_bbe ],float32 (_af ));if _bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"");};if _ebf {var (_dbc ,_fbg float64 ;_eedc ,_adf int ;);_dbc ,_bfdf =_cf .CorrelationScore (_dce ,_gfb ,_aeba ,_dga ,_fbe -_abbd ,_febd -_fga ,MaxDiffWidth ,MaxDiffHeight ,_gbfg );if _bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"d\u0065\u0062\u0075\u0067Co\u0072r\u0065\u006c\u0061\u0074\u0069o\u006e\u0053\u0063\u006f\u0072\u0065");};_fbg ,_bfdf =_cf .CorrelationScoreSimple (_dce ,_gfb ,_aeba ,_dga ,_fbe -_abbd ,_febd -_fga ,MaxDiffWidth ,MaxDiffHeight ,_gbfg );if _bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"d\u0065\u0062\u0075\u0067Co\u0072r\u0065\u006c\u0061\u0074\u0069o\u006e\u0053\u0063\u006f\u0072\u0065");};_eedc =int (_f .Sqrt (_dbc *float64 (_aeba )*float64 (_dga )));_adf =int (_f .Sqrt (_fbg *float64 (_aeba )*float64 (_dga )));if (_dbc >=_af )!=(_fbg >=_af ){return _d .Errorf (_cgb ,"\u0064\u0065\u0062\u0075\u0067\u0020\u0043\u006f\u0072r\u0065\u006c\u0061\u0074\u0069\u006f\u006e\u0020\u0073\u0063\u006f\u0072\u0065\u0020\u006d\u0069\u0073\u006d\u0061\u0074\u0063\u0068\u0020-\u0020\u0025d\u0028\u00250\u002e\u0034\u0066\u002c\u0020\u0025\u0076\u0029\u0020\u0076\u0073\u0020\u0025d(\u0025\u0030\u002e\u0034\u0066\u002c\u0020\u0025\u0076)\u0020\u0025\u0030\u002e\u0034\u0066",_eedc ,_dbc ,_dbc >=_af ,_adf ,_fbg ,_fbg >=_af ,_dbc -_fbg );};if _dbc >=_af !=_bda {return _d .Errorf (_cgb ,"\u0064\u0065\u0062\u0075\u0067\u0020\u0043o\u0072\u0072\u0065\u006c\u0061\u0074\u0069\u006f\u006e \u0073\u0063\u006f\u0072\u0065 \u004d\u0069\u0073\u006d\u0061t\u0063\u0068 \u0062\u0065\u0074w\u0065\u0065\u006e\u0020\u0063\u006frr\u0065\u006c\u0061\u0074\u0069\u006f\u006e\u0020/\u0020\u0074\u0068\u0072\u0065s\u0068\u006f\u006c\u0064\u002e\u0020\u0043\u006f\u006dpa\u0072\u0069\u0073\u006f\u006e:\u0020\u0025\u0030\u002e\u0034\u0066\u0028\u0025\u0030\u002e\u0034\u0066\u002c\u0020\u0025\u0064\u0029\u0020\u003e\u003d\u0020\u00250\u002e\u0034\u0066\u0028\u0025\u0030\u002e\u0034\u0066\u0029\u0020\u0076\u0073\u0020\u0025\u0076",_dbc ,_dbc *float64 (_aeba )*float64 (_dga ),_eedc ,_af ,float32 (_af )*float32 (_aeba )*float32 (_dga ),_bda );};};if _bda {_fcb =true ;if _bfdf =_aef .ClassIDs .Add (_ebfe );_bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"\u006f\u0076\u0065\u0072\u0054\u0068\u0072\u0065\u0073\u0068\u006f\u006c\u0064");};if _bfdf =_aef .ComponentPageNumbers .Add (_ea );_bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"\u006f\u0076\u0065\u0072\u0054\u0068\u0072\u0065\u0073\u0068\u006f\u006c\u0064");};if _aef .Settings .KeepClassInstances {if _gef ,_bfdf =_aee .GetBitmap (_bbe );_bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"\u004b\u0065\u0065\u0070Cl\u0061\u0073\u0073\u0049\u006e\u0073\u0074\u0061\u006e\u0063\u0065\u0073\u0020\u002d \u0069");};if _facb ,_bfdf =_aef .ClassInstances .GetBitmaps (_ebfe );_bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"K\u0065\u0065\u0070\u0043\u006c\u0061s\u0073\u0049\u006e\u0073\u0074\u0061\u006e\u0063\u0065s\u0020\u002d\u0020i\u0043l\u0061\u0073\u0073");};_facb .AddBitmap (_gef );if _gecg ,_bfdf =_gfa .Get (_bbe );_bfdf !=nil {return _d .Wrap (_bfdf ,_cgb ,"\u004be\u0065p\u0043\u006c\u0061\u0073\u0073I\u006e\u0073t\u0061\u006e\u0063\u0065\u0073");};_facb .AddBox (_gecg );};break ;};};if !_fcb {if _adbe =_aef .ClassIDs .Add (_ac );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};if _adbe =_aef .ComponentPageNumbers .Add (_ea );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_facb =&_cf .Bitmaps {};if _gef ,_adbe =_aee .GetBitmap (_bbe );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_facb .AddBitmap (_gef );_gda ,_ccf :=_gef .Width ,_gef .Height ;_cdc :=uint64 (_ccf )*uint64 (_gda );_aef .TemplatesSize .Add (_cdc ,_ac );if _gecg ,_adbe =_gfa .Get (_bbe );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};_facb .AddBox (_gecg );_aef .ClassInstances .AddBitmaps (_facb );_aef .CentroidPointsTemplates .AddPoint (_fbe ,_febd );_aef .FgTemplates .AddInt (_aeba );_aef .UndilatedTemplates .AddBitmap (_gef );_fda =(_dce .Width -2*JbAddedPixels )*(_dce .Height -2*JbAddedPixels );if _adbe =_aef .TemplateAreas .Add (_fda );_adbe !=nil {return _d .Wrap (_adbe ,_cgb ,"\u0021\u0066\u006f\u0075\u006e\u0064");};};};_aef .NumberOfClasses =len (_aef .UndilatedTemplates .Values );return nil ;};func (_ccfdg *Settings )SetDefault (){if _ccfdg .MaxCompWidth ==0{switch _ccfdg .Components {case _cf .ComponentConn :_ccfdg .MaxCompWidth =MaxConnCompWidth ;case _cf .ComponentCharacters :_ccfdg .MaxCompWidth =MaxCharCompWidth ;case _cf .ComponentWords :_ccfdg .MaxCompWidth =MaxWordCompWidth ;};};if _ccfdg .MaxCompHeight ==0{_ccfdg .MaxCompHeight =MaxCompHeight ;};if _ccfdg .Thresh ==0.0{_ccfdg .Thresh =0.9;};if _ccfdg .WeightFactor ==0.0{_ccfdg .WeightFactor =0.75;};if _ccfdg .RankHaus ==0.0{_ccfdg .RankHaus =0.97;};if _ccfdg .SizeHaus ==0{_ccfdg .SizeHaus =2;};};func (_ccc *Classer )classifyRankHaus (_dec *_cf .Boxes ,_fbd *_cf .Bitmaps ,_ggf int )error {const _cbe ="\u0063\u006ca\u0073\u0073\u0069f\u0079\u0052\u0061\u006e\u006b\u0048\u0061\u0075\u0073";if _dec ==nil {return _d .Error (_cbe ,"\u0062\u006fx\u0061\u0020\u006eo\u0074\u0020\u0064\u0065\u0066\u0069\u006e\u0065\u0064");};if _fbd ==nil {return _d .Error (_cbe ,"\u0070\u0069x\u0061\u0020\u006eo\u0074\u0020\u0064\u0065\u0066\u0069\u006e\u0065\u0064");};_fafc :=len (_fbd .Values );if _fafc ==0{return _d .Error (_cbe ,"e\u006dp\u0074\u0079\u0020\u006e\u0065\u0077\u0020\u0063o\u006d\u0070\u006f\u006een\u0074\u0073");};_be :=_fbd .CountPixels ();_dbb :=_ccc .Settings .SizeHaus ;_cbg :=_cf .SelCreateBrick (_dbb ,_dbb ,_dbb /2,_dbb /2,_cf .SelHit );_eae :=&_cf .Bitmaps {Values :make ([]*_cf .Bitmap ,_fafc )};_fcc :=&_cf .Bitmaps {Values :make ([]*_cf .Bitmap ,_fafc )};var (_fff ,_cag ,_dd *_cf .Bitmap ;_gee error ;);for _abc :=0;_abc < _fafc ;_abc ++{_fff ,_gee =_fbd .GetBitmap (_abc );if _gee !=nil {return _d .Wrap (_gee ,_cbe ,"");};_cag ,_gee =_fff .AddBorderGeneral (JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,JbAddedPixels ,0);if _gee !=nil {return _d .Wrap (_gee ,_cbe ,"");};_dd ,_gee =_cf .Dilate (nil ,_cag ,_cbg );if _gee !=nil {return _d .Wrap (_gee ,_cbe ,"");};_eae .Values [_fafc ]=_cag ;_fcc .Values [_fafc ]=_dd ;};_eda ,_gee :=_cf .Centroids (_eae .Values );if _gee !=nil {return _d .Wrap (_gee ,_cbe ,"");};if _gee =_eda .Add (_ccc .CentroidPoints );_gee !=nil {_b .Log .Trace ("\u004e\u006f\u0020\u0063en\u0074\u0072\u006f\u0069\u0064\u0073\u0020\u0074\u006f\u0020\u0061\u0064\u0064");};if _ccc .Settings .RankHaus ==1.0{_gee =_ccc .classifyRankHouseOne (_dec ,_fbd ,_eae ,_fcc ,_eda ,_ggf );}else {_gee =_ccc .classifyRankHouseNonOne (_dec ,_fbd ,_eae ,_fcc ,_eda ,_be ,_ggf );};if _gee !=nil {return _d .Wrap (_gee ,_cbe ,"");};return nil ;};