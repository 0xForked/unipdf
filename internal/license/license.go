//
// Copyright 2020 FoxyUtils ehf. All rights reserved.
//
// This is a commercial product and requires a license to operate.
// A trial license can be obtained at https://unidoc.io
//
// DO NOT EDIT: generated by unitwist Go source code obfuscator.
//
// Use of this source code is governed by the UniDoc End User License Agreement
// terms that can be accessed at https://unidoc.io/eula/

package license ;import (_dg "bytes";_ba "compress/gzip";_bb "crypto";_dggd "crypto/aes";_dd "crypto/cipher";_baa "crypto/rand";_bd "crypto/rsa";_cf "crypto/sha512";_bf "crypto/x509";_dgg "encoding/base64";_fe "encoding/hex";_c "encoding/json";_ge "encoding/pem";
_ec "errors";_gg "fmt";_fa "github.com/unidoc/unipdf/v3/common";_f "io";_gb "io/ioutil";_d "net";_g "net/http";_ff "os";_eg "path/filepath";_bg "sort";_eb "strings";_e "sync";_ea "time";);func MakeUnlicensedKey ()*LicenseKey {_ab :=LicenseKey {};_ab .CustomerName ="\u0055\u006e\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u0064";
_ab .Tier =LicenseTierUnlicensed ;_ab .CreatedAt =_ea .Now ().UTC ();_ab .CreatedAtInt =_ab .CreatedAt .Unix ();return &_ab ;};func (_ad *LicenseKey )IsLicensed ()bool {return _ad .Tier !=LicenseTierUnlicensed ||_ad ._eab };var _def =MakeUnlicensedKey ();
const (_dc ="\u002d\u002d\u002d--\u0042\u0045\u0047\u0049\u004e\u0020\u0055\u004e\u0049D\u004fC\u0020L\u0049C\u0045\u004e\u0053\u0045\u0020\u004b\u0045\u0059\u002d\u002d\u002d\u002d\u002d";_ecd ="\u002d\u002d\u002d\u002d\u002d\u0045\u004e\u0044\u0020\u0055\u004e\u0049\u0044\u004f\u0043 \u004cI\u0043\u0045\u004e\u0053\u0045\u0020\u004b\u0045\u0059\u002d\u002d\u002d\u002d\u002d";
);var _ee =_ea .Date (2010,1,1,0,0,0,0,_ea .UTC );func _fba ()*meteredClient {_agc :=meteredClient {_gbdc :"h\u0074\u0074\u0070\u0073\u003a\u002f/\u0063\u006c\u006f\u0075\u0064\u002e\u0075\u006e\u0069d\u006f\u0063\u002ei\u006f/\u0061\u0070\u0069",_aab :&_g .Client {Timeout :30*_ea .Second }};
if _dbb :=_ff .Getenv ("\u0055N\u0049\u0044\u004f\u0043_\u004c\u0049\u0043\u0045\u004eS\u0045_\u0053E\u0052\u0056\u0045\u0052\u005f\u0055\u0052L");_eb .HasPrefix (_dbb ,"\u0068\u0074\u0074\u0070"){_agc ._gbdc =_dbb ;};return &_agc ;};func (_bcc defaultStateHolder )updateState (_fd ,_ega ,_ecg string ,_ddb int ,_gaf bool ,_cag int ,_gca int ,_fcee _ea .Time ,_bdf map[string ]int )error {_agd :=_cgc ();
if len (_agd )==0{return _ec .New ("\u0068\u006fm\u0065\u0020\u0064i\u0072\u0020\u006e\u006f\u0074\u0020\u0073\u0065\u0074");};_abf :=_eg .Join (_agd ,"\u002eu\u006e\u0069\u0064\u006f\u0063");_feb :=_ff .MkdirAll (_abf ,0777);if _feb !=nil {return _feb ;
};if len (_fd )< 20{return _ec .New ("i\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006b\u0065\u0079");};_bdb :=[]byte (_fd );_fgb :=_cf .Sum512_256 (_bdb [:20]);_afd :=_fe .EncodeToString (_fgb [:]);_cba :=_eg .Join (_abf ,_afd );var _dcfc reportState ;
_dcfc .Docs =int64 (_ddb );_dcfc .NumErrors =int64 (_gca );_dcfc .LimitDocs =_gaf ;_dcfc .RemainingDocs =int64 (_cag );_dcfc .LastWritten =_ea .Now ().UTC ();_dcfc .LastReported =_fcee ;_dcfc .Instance =_ega ;_dcfc .Next =_ecg ;_dcfc .Usage =_bdf ;_fae ,_feb :=_c .Marshal (_dcfc );
if _feb !=nil {return _feb ;};const _ada ="\u0068\u00619\u004e\u004b\u0038]\u0052\u0062\u004c\u002a\u006d\u0034\u004c\u004b\u0057";_fae ,_feb =_eaeg ([]byte (_ada ),_fae );if _feb !=nil {return _feb ;};_feb =_gb .WriteFile (_cba ,_fae ,0600);if _feb !=nil {return _feb ;
};return nil ;};type meteredUsageCheckinResp struct{Instance string `json:"inst"`;Next string `json:"next"`;Success bool `json:"success"`;Message string `json:"message"`;RemainingDocs int `json:"rd"`;LimitDocs bool `json:"ld"`;};func _dcf (_ae string )(LicenseKey ,error ){var _de LicenseKey ;
_ed ,_ga :=_cfd (_dc ,_ecd ,_ae );if _ga !=nil {return _de ,_ga ;};_fgf ,_ga :=_a (_gcg ,_ed );if _ga !=nil {return _de ,_ga ;};_ga =_c .Unmarshal (_fgf ,&_de );if _ga !=nil {return _de ,_ga ;};_de .CreatedAt =_ea .Unix (_de .CreatedAtInt ,0);if _de .ExpiresAtInt > 0{_fed :=_ea .Unix (_de .ExpiresAtInt ,0);
_de .ExpiresAt =&_fed ;};return _de ,nil ;};type stateLoader interface{loadState (_ebe string )(reportState ,error );updateState (_aga ,_gc ,_bee string ,_cfg int ,_fgc bool ,_ecc int ,_bde int ,_da _ea .Time ,_edf map[string ]int )error ;};type meteredClient struct{_gbdc string ;
_dcab string ;_aab *_g .Client ;};type defaultStateHolder struct{};type meteredStatusForm struct{};func GetMeteredState ()(MeteredStatus ,error ){if _def ==nil {return MeteredStatus {},_ec .New ("\u006c\u0069\u0063\u0065ns\u0065\u0020\u006b\u0065\u0079\u0020\u006e\u006f\u0074\u0020\u0073\u0065\u0074");
};if !_def ._eab ||len (_def ._dca )==0{return MeteredStatus {},_ec .New ("\u0061p\u0069 \u006b\u0065\u0079\u0020\u006e\u006f\u0074\u0020\u0073\u0065\u0074");};_dge ,_dfb :=_cgd .loadState (_def ._dca );if _dfb !=nil {_fa .Log .Debug ("\u0045R\u0052\u004f\u0052\u003a\u0020\u0025v",_dfb );
return MeteredStatus {},_dfb ;};if _dge .Docs > 0{_aggf :=_egg ("","",true );if _aggf !=nil {return MeteredStatus {},_aggf ;};};_daf .Lock ();defer _daf .Unlock ();_gfb :=_fba ();_gfb ._dcab =_def ._dca ;_ece ,_dfb :=_gfb .getStatus ();if _dfb !=nil {return MeteredStatus {},_dfb ;
};if !_ece .Valid {return MeteredStatus {},_ec .New ("\u006b\u0065\u0079\u0020\u006e\u006f\u0074\u0020\u0076\u0061\u006c\u0069\u0064");};_ged :=MeteredStatus {OK :true ,Credits :_ece .OrgCredits ,Used :_ece .OrgUsed };return _ged ,nil ;};func _eaeg (_gfgc ,_bbeb []byte )([]byte ,error ){_gee ,_gfgd :=_dggd .NewCipher (_gfgc );
if _gfgd !=nil {return nil ,_gfgd ;};_eaf :=make ([]byte ,_dggd .BlockSize +len (_bbeb ));_gbc :=_eaf [:_dggd .BlockSize ];if _ ,_cagf :=_f .ReadFull (_baa .Reader ,_gbc );_cagf !=nil {return nil ,_cagf ;};_bfge :=_dd .NewCFBEncrypter (_gee ,_gbc );_bfge .XORKeyStream (_eaf [_dggd .BlockSize :],_bbeb );
_aege :=make ([]byte ,_dgg .URLEncoding .EncodedLen (len (_eaf )));_dgg .URLEncoding .Encode (_aege ,_eaf );return _aege ,nil ;};type meteredUsageCheckinForm struct{Instance string `json:"inst"`;Next string `json:"next"`;UsageNumber int `json:"usage_number"`;
NumFailed int64 `json:"num_failed"`;Hostname string `json:"hostname"`;LocalIP string `json:"local_ip"`;MacAddress string `json:"mac_address"`;Package string `json:"package"`;PackageVersion string `json:"package_version"`;Usage map[string ]int `json:"u"`;
};type LicenseKey struct{LicenseId string `json:"license_id"`;CustomerId string `json:"customer_id"`;CustomerName string `json:"customer_name"`;Tier string `json:"tier"`;CreatedAt _ea .Time `json:"-"`;CreatedAtInt int64 `json:"created_at"`;ExpiresAt *_ea .Time `json:"-"`;
ExpiresAtInt int64 `json:"expires_at"`;CreatedBy string `json:"created_by"`;CreatorName string `json:"creator_name"`;CreatorEmail string `json:"creator_email"`;UniPDF bool `json:"unipdf"`;UniOffice bool `json:"unioffice"`;UniHTML bool `json:"unihtml"`;
Trial bool `json:"trial"`;_eab bool ;_dca string ;};const _gcfc ="U\u004eI\u0050\u0044\u0046\u005f\u0043\u0055\u0053\u0054O\u004d\u0045\u0052\u005fNA\u004d\u0045";func (_ecdb *LicenseKey )isExpired ()bool {return _ecdb .getExpiryDateToCompare ().After (*_ecdb .ExpiresAt );
};type meteredStatusResp struct{Valid bool `json:"valid"`;OrgCredits int64 `json:"org_credits"`;OrgUsed int64 `json:"org_used"`;OrgRemaining int64 `json:"org_remaining"`;};func SetLicenseKey (content string ,customerName string )error {_bfe ,_bdc :=_dcf (content );
if _bdc !=nil {_fa .Log .Error ("\u004c\u0069c\u0065\u006e\u0073\u0065\u0020\u0063\u006f\u0064\u0065\u0020\u0064\u0065\u0063\u006f\u0064\u0065\u0020\u0065\u0072\u0072\u006f\u0072: \u0025\u0076",_bdc );return _bdc ;};if !_eb .EqualFold (_bfe .CustomerName ,customerName ){_fa .Log .Error ("L\u0069ce\u006es\u0065 \u0063\u006f\u0064\u0065\u0020i\u0073\u0073\u0075e\u0020\u002d\u0020\u0043\u0075s\u0074\u006f\u006de\u0072\u0020\u006e\u0061\u006d\u0065\u0020\u006d\u0069\u0073\u006da\u0074\u0063\u0068, e\u0078\u0070\u0065\u0063\u0074\u0065d\u0020\u0027\u0025\u0073\u0027\u002c\u0020\u0062\u0075\u0074\u0020\u0067o\u0074 \u0027\u0025\u0073\u0027",customerName ,_bfe .CustomerName );
return _gg .Errorf ("\u0063\u0075\u0073\u0074\u006fm\u0065\u0072\u0020\u006e\u0061\u006d\u0065\u0020\u006d\u0069\u0073\u006d\u0061t\u0063\u0068\u002c\u0020\u0065\u0078\u0070\u0065\u0063\u0074\u0065\u0064\u0020\u0027\u0025\u0073\u0027\u002c\u0020\u0062\u0075\u0074\u0020\u0067\u006f\u0074\u0020\u0027\u0025\u0073'",customerName ,_bfe .CustomerName );
};_bdc =_bfe .Validate ();if _bdc !=nil {_fa .Log .Error ("\u004c\u0069\u0063\u0065\u006e\u0073e\u0020\u0063\u006f\u0064\u0065\u0020\u0076\u0061\u006c\u0069\u0064\u0061\u0074i\u006f\u006e\u0020\u0065\u0072\u0072\u006fr\u003a\u0020\u0025\u0076",_bdc );return _bdc ;
};_def =&_bfe ;return nil ;};func TrackUse (useKey string ){if _def ==nil {return ;};if !_def ._eab ||len (_def ._dca )==0{return ;};if len (useKey )==0{return ;};_daf .Lock ();defer _daf .Unlock ();if _ggb ==nil {_ggb =map[string ]int {};};_ggb [useKey ]++;
};var _ffa =_ea .Date (2019,6,6,0,0,0,0,_ea .UTC );func _cfgd (_dff []byte )(_f .Reader ,error ){_fge :=new (_dg .Buffer );_fbe :=_ba .NewWriter (_fge );_fbe .Write (_dff );_fag :=_fbe .Close ();if _fag !=nil {return nil ,_fag ;};return _fge ,nil ;};func _dec ()(_d .IP ,error ){_adb ,_bbf :=_d .Dial ("\u0075\u0064\u0070","\u0038\u002e\u0038\u002e\u0038\u002e\u0038\u003a\u0038\u0030");
if _bbf !=nil {return nil ,_bbf ;};defer _adb .Close ();_bga :=_adb .LocalAddr ().(*_d .UDPAddr );return _bga .IP ,nil ;};func _dae (_ecef ,_gbda []byte )([]byte ,error ){_ace :=make ([]byte ,_dgg .URLEncoding .DecodedLen (len (_gbda )));_bgf ,_aabc :=_dgg .URLEncoding .Decode (_ace ,_gbda );
if _aabc !=nil {return nil ,_aabc ;};_ace =_ace [:_bgf ];_adaf ,_aabc :=_dggd .NewCipher (_ecef );if _aabc !=nil {return nil ,_aabc ;};if len (_ace )< _dggd .BlockSize {return nil ,_ec .New ("c\u0069p\u0068\u0065\u0072\u0074\u0065\u0078\u0074\u0020t\u006f\u006f\u0020\u0073ho\u0072\u0074");
};_daed :=_ace [:_dggd .BlockSize ];_ace =_ace [_dggd .BlockSize :];_fbc :=_dd .NewCFBDecrypter (_adaf ,_daed );_fbc .XORKeyStream (_ace ,_ace );return _ace ,nil ;};var _dde map[string ]struct{};func Track (docKey string ,useKey string )error {return _egg (docKey ,useKey ,false )};
const _gcg ="\u000a\u002d\u002d\u002d\u002d\u002d\u0042\u0045\u0047\u0049\u004e \u0050\u0055\u0042\u004c\u0049\u0043\u0020\u004b\u0045Y\u002d\u002d\u002d\u002d\u002d\u000a\u004d\u0049I\u0042\u0049\u006a\u0041NB\u0067\u006b\u0071\u0068\u006b\u0069G\u0039\u0077\u0030\u0042\u0041\u0051\u0045\u0046A\u0041\u004f\u0043\u0041\u0051\u0038\u0041\u004d\u0049\u0049\u0042\u0043\u0067\u004b\u0043\u0041\u0051\u0045A\u006dF\u0055\u0069\u0079\u0064\u0037\u0062\u0035\u0058\u006a\u0070\u006b\u0050\u0035\u0052\u0061\u0070\u0034\u0077\u000a\u0044\u0063\u0031d\u0079\u007a\u0049\u0051\u0034\u004c\u0065\u006b\u0078\u0072\u0076\u0079\u0074\u006e\u0045\u004d\u0070\u004e\u0055\u0062\u006f\u0036i\u0041\u0037\u0034\u0056\u0038\u0072\u0075\u005a\u004f\u0076\u0072\u0053\u0063\u0073\u0066\u0032\u0051\u0065\u004e9\u002f\u0071r\u0055\u0047\u0038\u0071\u0045\u0062\u0055\u0057\u0064\u006f\u0045\u0059\u0071+\u000a\u006f\u0074\u0046\u004e\u0041\u0046N\u0078\u006c\u0047\u0062\u0078\u0062\u0044\u0048\u0063\u0064\u0047\u0056\u0061\u004d\u0030\u004f\u0058\u0064\u0058g\u0044y\u004c5\u0061\u0049\u0045\u0061\u0067\u004c\u0030\u0063\u0035\u0070\u0077\u006a\u0049\u0064\u0050G\u0049\u006e\u0034\u0036\u0066\u0037\u0038\u0065\u004d\u004a\u002b\u004a\u006b\u0064\u0063\u0070\u0044\n\u0044\u004a\u0061\u0071\u0059\u0058d\u0072\u007a5\u004b\u0065\u0073\u0068\u006aS\u0069\u0049\u0061\u0061\u0037\u006d\u0065\u006e\u0042\u0049\u0041\u0058\u0053\u0034\u0055\u0046\u0078N\u0066H\u0068\u004e\u0030\u0048\u0043\u0059\u005a\u0059\u0071\u0051\u0047\u0037\u0062K+\u0073\u0035\u0072R\u0048\u006f\u006e\u0079\u0064\u004eW\u0045\u0047\u000a\u0048\u0038M\u0079\u0076\u00722\u0070\u0079\u0061\u0032K\u0072\u004d\u0075m\u0066\u006d\u0041\u0078\u0055\u0042\u0036\u0066\u0065\u006e\u0043\u002f4\u004f\u0030\u0057\u00728\u0067\u0066\u0050\u004f\u0055\u0038R\u0069\u0074\u006d\u0062\u0044\u0076\u0051\u0050\u0049\u0052\u0058\u004fL\u0034\u0076\u0054B\u0072\u0042\u0064\u0062a\u0041\u000a9\u006e\u0077\u004e\u0050\u002b\u0069\u002f\u002f\u0032\u0030\u004d\u00542\u0062\u0078\u006d\u0065\u0057\u0042\u002b\u0067\u0070\u0063\u0045\u0068G\u0070\u0058\u005a7\u0033\u0033\u0061\u007a\u0051\u0078\u0072\u0043\u0033\u004a\u0034\u0076\u0033C\u005a\u006d\u0045\u004eS\u0074\u0044\u004b\u002f\u004b\u0044\u0053\u0050\u004b\u0055\u0047\u0066\u00756\u000a\u0066\u0077I\u0044\u0041\u0051\u0041\u0042\u000a\u002d\u002d\u002d\u002d\u002dE\u004e\u0044\u0020\u0050\u0055\u0042\u004c\u0049\u0043 \u004b\u0045Y\u002d\u002d\u002d\u002d\u002d\n";
func _cgc ()string {_cfef :=_ff .Getenv ("\u0048\u004f\u004d\u0045");if len (_cfef )==0{_cfef ,_ =_ff .UserHomeDir ();};return _cfef ;};func GetLicenseKey ()*LicenseKey {if _def ==nil {return nil ;};_fda :=*_def ;return &_fda ;};func (_agg *LicenseKey )TypeToString ()string {if _agg ._eab {return "M\u0065t\u0065\u0072\u0065\u0064\u0020\u0073\u0075\u0062s\u0063\u0072\u0069\u0070ti\u006f\u006e";
};if _agg .Tier ==LicenseTierUnlicensed {return "\u0055\u006e\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u0064";};if _agg .Tier ==LicenseTierCommunity {return "\u0041\u0047PL\u0076\u0033\u0020O\u0070\u0065\u006e\u0020Sou\u0072ce\u0020\u0043\u006f\u006d\u006d\u0075\u006eit\u0079\u0020\u004c\u0069\u0063\u0065\u006es\u0065";
};if _agg .Tier ==LicenseTierIndividual ||_agg .Tier =="\u0069\u006e\u0064i\u0065"{return "\u0043\u006f\u006dm\u0065\u0072\u0063\u0069a\u006c\u0020\u004c\u0069\u0063\u0065\u006es\u0065\u0020\u002d\u0020\u0049\u006e\u0064\u0069\u0076\u0069\u0064\u0075\u0061\u006c";
};return "\u0043\u006fm\u006d\u0065\u0072\u0063\u0069\u0061\u006c\u0020\u004c\u0069\u0063\u0065\u006e\u0073\u0065\u0020\u002d\u0020\u0042\u0075\u0073\u0069ne\u0073\u0073";};var _beb =_ea .Date (2020,1,1,0,0,0,0,_ea .UTC );func _egg (_cfc string ,_ddeg string ,_agdd bool )error {if _def ==nil {return _ec .New ("\u006e\u006f\u0020\u006c\u0069\u0063\u0065\u006e\u0073e\u0020\u006b\u0065\u0079");
};if !_def ._eab ||len (_def ._dca )==0{return nil ;};if len (_cfc )==0&&!_agdd {return _ec .New ("\u0064\u006f\u0063\u004b\u0065\u0079\u0020\u006e\u006ft\u0020\u0073\u0065\u0074");};_daf .Lock ();defer _daf .Unlock ();if _dde ==nil {_dde =map[string ]struct{}{};
};if _ggb ==nil {_ggb =map[string ]int {};};_dfa :=0;if !_agdd {_ ,_cfa :=_dde [_cfc ];if !_cfa {_dde [_cfc ]=struct{}{};_dfa ++;};if _dfa ==0{return nil ;};_ggb [_ddeg ]++;};_agge :=_ea .Now ();_dgd ,_cbc :=_cgd .loadState (_def ._dca );if _cbc !=nil {_fa .Log .Debug ("\u0045R\u0052\u004f\u0052\u003a\u0020\u0025v",_cbc );
return _cbc ;};if _dgd .Usage ==nil {_dgd .Usage =map[string ]int {};};for _gbdg ,_gad :=range _ggb {_dgd .Usage [_gbdg ]+=_gad ;};_ggb =nil ;const _bdee =24*_ea .Hour ;const _dbf =3*24*_ea .Hour ;if len (_dgd .Instance )==0||_agge .Sub (_dgd .LastReported )> _bdee ||(_dgd .LimitDocs &&_dgd .RemainingDocs <=_dgd .Docs +int64 (_dfa ))||_agdd {_becc ,_fee :=_ff .Hostname ();
if _fee !=nil {return _fee ;};_bbc :=_dgd .Docs ;_edd ,_bafa ,_fee :=_gda ();if _fee !=nil {return _fee ;};_bg .Strings (_bafa );_bg .Strings (_edd );_ffd ,_fee :=_dec ();if _fee !=nil {return _fee ;};_eggc :=false ;for _ ,_gcf :=range _bafa {if _gcf ==_ffd .String (){_eggc =true ;
};};if !_eggc {_bafa =append (_bafa ,_ffd .String ());};_dad :=_fba ();_dad ._dcab =_def ._dca ;_bbc +=int64 (_dfa );_bgea :=meteredUsageCheckinForm {Instance :_dgd .Instance ,Next :_dgd .Next ,UsageNumber :int (_bbc ),NumFailed :_dgd .NumErrors ,Hostname :_becc ,LocalIP :_eb .Join (_bafa ,"\u002c\u0020"),MacAddress :_eb .Join (_edd ,"\u002c\u0020"),Package :"\u0075\u006e\u0069\u0070\u0064\u0066",PackageVersion :_fa .Version ,Usage :_dgd .Usage };
if len (_edd )==0{_bgea .MacAddress ="\u006e\u006f\u006e\u0065";};_gga :=int64 (0);_afdg :=_dgd .NumErrors ;_gac :=_agge ;_bgd :=0;_cc :=_dgd .LimitDocs ;_egc ,_fee :=_dad .checkinUsage (_bgea );if _fee !=nil {if _agge .Sub (_dgd .LastReported )> _dbf {return _ec .New ("\u0074\u006f\u006f\u0020\u006c\u006f\u006e\u0067\u0020\u0073\u0069\u006e\u0063\u0065\u0020\u006c\u0061\u0073\u0074\u0020\u0073\u0075\u0063\u0063e\u0073\u0073\u0066\u0075\u006c \u0063\u0068e\u0063\u006b\u0069\u006e");
};_gga =_bbc ;_afdg ++;_gac =_dgd .LastReported ;}else {_cc =_egc .LimitDocs ;_bgd =_egc .RemainingDocs ;_afdg =0;};if len (_egc .Instance )==0{_egc .Instance =_bgea .Instance ;};if len (_egc .Next )==0{_egc .Next =_bgea .Next ;};_fee =_cgd .updateState (_dad ._dcab ,_egc .Instance ,_egc .Next ,int (_gga ),_cc ,_bgd ,int (_afdg ),_gac ,nil );
if _fee !=nil {return _fee ;};if !_egc .Success {return _gg .Errorf ("\u0065r\u0072\u006f\u0072\u003a\u0020\u0025s",_egc .Message );};}else {_cbc =_cgd .updateState (_def ._dca ,_dgd .Instance ,_dgd .Next ,int (_dgd .Docs )+_dfa ,_dgd .LimitDocs ,int (_dgd .RemainingDocs ),int (_dgd .NumErrors ),_dgd .LastReported ,_dgd .Usage );
if _cbc !=nil {return _cbc ;};};return nil ;};var _cgd stateLoader =defaultStateHolder {};type MeteredStatus struct{OK bool ;Credits int64 ;Used int64 ;};func _a (_db string ,_gea string )([]byte ,error ){var (_ce int ;_fce string ;);for _ ,_fce =range []string {"\u000a\u002b\u000a","\u000d\u000a\u002b\r\u000a","\u0020\u002b\u0020"}{if _ce =_eb .Index (_gea ,_fce );
_ce !=-1{break ;};};if _ce ==-1{return nil ,_gg .Errorf ("\u0069\u006e\u0076al\u0069\u0064\u0020\u0069\u006e\u0070\u0075\u0074\u002c \u0073i\u0067n\u0061t\u0075\u0072\u0065\u0020\u0073\u0065\u0070\u0061\u0072\u0061\u0074\u006f\u0072");};_ffc :=_gea [:_ce ];
_bge :=_ce +len (_fce );_gbd :=_gea [_bge :];if _ffc ==""||_gbd ==""{return nil ,_gg .Errorf ("\u0069n\u0076\u0061l\u0069\u0064\u0020\u0069n\u0070\u0075\u0074,\u0020\u006d\u0069\u0073\u0073\u0069\u006e\u0067\u0020or\u0069\u0067\u0069n\u0061\u006c \u006f\u0072\u0020\u0073\u0069\u0067n\u0061\u0074u\u0072\u0065");
};_gd ,_dceg :=_dgg .StdEncoding .DecodeString (_ffc );if _dceg !=nil {return nil ,_gg .Errorf ("\u0069\u006e\u0076\u0061li\u0064\u0020\u0069\u006e\u0070\u0075\u0074\u0020\u006f\u0072\u0069\u0067\u0069\u006ea\u006c");};_bc ,_dceg :=_dgg .StdEncoding .DecodeString (_gbd );
if _dceg !=nil {return nil ,_gg .Errorf ("\u0069\u006e\u0076al\u0069\u0064\u0020\u0069\u006e\u0070\u0075\u0074\u0020\u0073\u0069\u0067\u006e\u0061\u0074\u0075\u0072\u0065");};_bed ,_ :=_ge .Decode ([]byte (_db ));if _bed ==nil {return nil ,_gg .Errorf ("\u0050\u0075\u0062\u004b\u0065\u0079\u0020\u0066\u0061\u0069\u006c\u0065\u0064");
};_fg ,_dceg :=_bf .ParsePKIXPublicKey (_bed .Bytes );if _dceg !=nil {return nil ,_dceg ;};_gec :=_fg .(*_bd .PublicKey );if _gec ==nil {return nil ,_gg .Errorf ("\u0050u\u0062\u004b\u0065\u0079\u0020\u0063\u006f\u006e\u0076\u0065\u0072s\u0069\u006f\u006e\u0020\u0066\u0061\u0069\u006c\u0065\u0064");
};_fga :=_cf .New ();_fga .Write (_gd );_ag :=_fga .Sum (nil );_dceg =_bd .VerifyPKCS1v15 (_gec ,_bb .SHA512 ,_ag ,_bc );if _dceg !=nil {return nil ,_dceg ;};return _gd ,nil ;};const (LicenseTierUnlicensed ="\u0075\u006e\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u0064";
LicenseTierCommunity ="\u0063o\u006d\u006d\u0075\u006e\u0069\u0074y";LicenseTierIndividual ="\u0069\u006e\u0064\u0069\u0076\u0069\u0064\u0075\u0061\u006c";LicenseTierBusiness ="\u0062\u0075\u0073\u0069\u006e\u0065\u0073\u0073";);func _gda ()([]string ,[]string ,error ){_aeg ,_ffg :=_d .Interfaces ();
if _ffg !=nil {return nil ,nil ,_ffg ;};var _bfd []string ;var _bbff []string ;for _ ,_daa :=range _aeg {if _daa .Flags &_d .FlagUp ==0||_dg .Equal (_daa .HardwareAddr ,nil ){continue ;};_gbdd ,_ccd :=_daa .Addrs ();if _ccd !=nil {return nil ,nil ,_ccd ;
};_bbea :=0;for _ ,_bcf :=range _gbdd {var _dcb _d .IP ;switch _ac :=_bcf .(type ){case *_d .IPNet :_dcb =_ac .IP ;case *_d .IPAddr :_dcb =_ac .IP ;};if _dcb .IsLoopback (){continue ;};if _dcb .To4 ()==nil {continue ;};_bbff =append (_bbff ,_dcb .String ());
_bbea ++;};_cdf :=_daa .HardwareAddr .String ();if _cdf !=""&&_bbea > 0{_bfd =append (_bfd ,_cdf );};};return _bfd ,_bbff ,nil ;};func _bcg (_dee *_g .Response )([]byte ,error ){var _gdac []byte ;_bebb ,_dgde :=_gcd (_dee );if _dgde !=nil {return _gdac ,_dgde ;
};return _gb .ReadAll (_bebb );};type reportState struct{Instance string `json:"inst"`;Next string `json:"n"`;Docs int64 `json:"d"`;NumErrors int64 `json:"e"`;LimitDocs bool `json:"ld"`;RemainingDocs int64 `json:"rd"`;LastReported _ea .Time `json:"lr"`;
LastWritten _ea .Time `json:"lw"`;Usage map[string ]int `json:"u"`;};func (_cfe defaultStateHolder )loadState (_dfe string )(reportState ,error ){_fca :=_cgc ();if len (_fca )==0{return reportState {},_ec .New ("\u0068\u006fm\u0065\u0020\u0064i\u0072\u0020\u006e\u006f\u0074\u0020\u0073\u0065\u0074");
};_dfd :=_eg .Join (_fca ,"\u002eu\u006e\u0069\u0064\u006f\u0063");_fgg :=_ff .MkdirAll (_dfd ,0777);if _fgg !=nil {return reportState {},_fgg ;};if len (_dfe )< 20{return reportState {},_ec .New ("i\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006b\u0065\u0079");
};_dgba :=[]byte (_dfe );_gge :=_cf .Sum512_256 (_dgba [:20]);_afc :=_fe .EncodeToString (_gge [:]);_efg :=_eg .Join (_dfd ,_afc );_ebb ,_fgg :=_gb .ReadFile (_efg );if _fgg !=nil {if _ff .IsNotExist (_fgg ){return reportState {},nil ;};_fa .Log .Debug ("\u0045R\u0052\u004f\u0052\u003a\u0020\u0025v",_fgg );
return reportState {},_ec .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0064\u0061\u0074\u0061");};const _dcfe ="\u0068\u00619\u004e\u004b\u0038]\u0052\u0062\u004c\u002a\u006d\u0034\u004c\u004b\u0057";_ebb ,_fgg =_dae ([]byte (_dcfe ),_ebb );if _fgg !=nil {return reportState {},_fgg ;
};var _ggf reportState ;_fgg =_c .Unmarshal (_ebb ,&_ggf );if _fgg !=nil {_fa .Log .Debug ("\u0045\u0052\u0052OR\u003a\u0020\u0049\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u0064\u0061\u0074\u0061\u003a\u0020\u0025\u0076",_fgg );return reportState {},_ec .New ("\u0069\u006e\u0076a\u006c\u0069\u0064\u0020\u0064\u0061\u0074\u0061");
};return _ggf ,nil ;};var _daf =&_e .Mutex {};const _bab ="\u0055\u004e\u0049\u0050DF\u005f\u004c\u0049\u0043\u0045\u004e\u0053\u0045\u005f\u0050\u0041\u0054\u0048";func SetMeteredKey (apiKey string )error {if _def !=nil &&(_def ._eab ||_def .Tier !=LicenseTierUnlicensed ){_fa .Log .Error ("\u0045\u0052\u0052\u004f\u0052:\u0020\u0043\u0061\u006e\u006eo\u0074 \u0073\u0065\u0074\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u0020\u006b\u0065\u0079\u0020\u0074\u0077\u0069c\u0065\u0020\u002d\u0020\u0053\u0068\u006f\u0075\u006c\u0064\u0020\u006a\u0075\u0073\u0074\u0020\u0069\u006e\u0069\u0074\u0069\u0061\u006c\u0069z\u0065\u0020\u006f\u006e\u0063\u0065");
return _ec .New ("\u006c\u0069\u0063en\u0073\u0065\u0020\u006b\u0065\u0079\u0020\u0061\u006c\u0072\u0065\u0061\u0064\u0079\u0020\u0073\u0065\u0074");};_ddde :=_fba ();_ddde ._dcab =apiKey ;_cb ,_bbe :=_ddde .getStatus ();if _bbe !=nil {return _bbe ;};if !_cb .Valid {return _ec .New ("\u006b\u0065\u0079\u0020\u006e\u006f\u0074\u0020\u0076\u0061\u006c\u0069\u0064");
};_bebe :=&LicenseKey {_eab :true ,_dca :apiKey };_def =_bebe ;return nil ;};func (_af *LicenseKey )Validate ()error {if _af ._eab {return nil ;};if len (_af .LicenseId )< 10{return _gg .Errorf ("i\u006e\u0076\u0061\u006c\u0069\u0064 \u006c\u0069\u0063\u0065\u006e\u0073\u0065\u003a\u0020L\u0069\u0063\u0065n\u0073e\u0020\u0049\u0064");
};if len (_af .CustomerId )< 10{return _gg .Errorf ("\u0069\u006e\u0076\u0061l\u0069\u0064\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065:\u0020C\u0075\u0073\u0074\u006f\u006d\u0065\u0072 \u0049\u0064");};if len (_af .CustomerName )< 1{return _gg .Errorf ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006c\u0069c\u0065\u006e\u0073\u0065\u003a\u0020\u0043u\u0073\u0074\u006f\u006d\u0065\u0072\u0020\u004e\u0061\u006d\u0065");
};if _ee .After (_af .CreatedAt ){return _gg .Errorf ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u003a\u0020\u0043\u0072\u0065\u0061\u0074\u0065\u0064 \u0041\u0074\u0020\u0069\u0073 \u0069\u006ev\u0061\u006c\u0069\u0064");
};if _af .ExpiresAt ==nil {_geag :=_af .CreatedAt .AddDate (1,0,0);if _beb .After (_geag ){_geag =_beb ;};_af .ExpiresAt =&_geag ;};if _af .CreatedAt .After (*_af .ExpiresAt ){return _gg .Errorf ("i\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u003a\u0020\u0043\u0072\u0065\u0061\u0074\u0065\u0064\u0020\u0041\u0074 \u0063a\u006e\u006e\u006f\u0074 \u0062\u0065 \u0047\u0072\u0065\u0061\u0074\u0065\u0072\u0020\u0074\u0068\u0061\u006e\u0020\u0045\u0078\u0070\u0069\u0072\u0065\u0073\u0020\u0041\u0074");
};if _af .isExpired (){return _gg .Errorf ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020l\u0069\u0063\u0065ns\u0065\u003a\u0020\u0054\u0068\u0065 \u006c\u0069\u0063\u0065\u006e\u0073\u0065\u0020\u0068\u0061\u0073\u0020\u0061\u006c\u0072e\u0061\u0064\u0079\u0020\u0065\u0078\u0070\u0069r\u0065\u0064");
};if len (_af .CreatorName )< 1{return _gg .Errorf ("\u0069\u006ev\u0061\u006c\u0069\u0064\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065\u003a\u0020\u0043\u0072\u0065\u0061\u0074\u006f\u0072\u0020na\u006d\u0065");};if len (_af .CreatorEmail )< 1{return _gg .Errorf ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006c\u0069c\u0065\u006e\u0073\u0065\u003a\u0020\u0043r\u0065\u0061\u0074\u006f\u0072\u0020\u0065\u006d\u0061\u0069\u006c");
};if _af .CreatedAt .After (_ffa ){if !_af .UniPDF {return _gg .Errorf ("\u0069\u006e\u0076\u0061\u006c\u0069\u0064\u0020\u006c\u0069\u0063\u0065\u006e\u0073\u0065:\u0020\u0054\u0068\u0069\u0073\u0020\u0055\u006e\u0069\u0044\u006f\u0063\u0020k\u0065\u0079\u0020\u0069\u0073\u0020\u0069\u006e\u0076\u0061\u006c\u0069d \u0066\u006f\u0072\u0020\u0055\u006e\u0069\u0050\u0044\u0046");
};};return nil ;};func _cfd (_ffb string ,_ege string ,_cab string )(string ,error ){_bgc :=_eb .Index (_cab ,_ffb );if _bgc ==-1{return "",_gg .Errorf ("\u0068\u0065a\u0064\u0065\u0072 \u006e\u006f\u0074\u0020\u0066\u006f\u0075\u006e\u0064");};_ceb :=_eb .Index (_cab ,_ege );
if _ceb ==-1{return "",_gg .Errorf ("\u0066\u006fo\u0074\u0065\u0072 \u006e\u006f\u0074\u0020\u0066\u006f\u0075\u006e\u0064");};_ef :=_bgc +len (_ffb )+1;return _cab [_ef :_ceb -1],nil ;};func init (){_fgd :=_ff .Getenv (_bab );_ccc :=_ff .Getenv (_gcfc );
if len (_fgd )==0||len (_ccc )==0{return ;};_acb ,_gef :=_gb .ReadFile (_fgd );if _gef !=nil {_fa .Log .Error ("\u0055\u006eab\u006c\u0065\u0020t\u006f\u0020\u0072\u0065ad \u006cic\u0065\u006e\u0073\u0065\u0020\u0063\u006fde\u0020\u0066\u0069\u006c\u0065\u003a\u0020%\u0076",_gef );
return ;};_gef =SetLicenseKey (string (_acb ),_ccc );if _gef !=nil {_fa .Log .Error ("\u0055\u006e\u0061b\u006c\u0065\u0020\u0074o\u0020\u006c\u006f\u0061\u0064\u0020\u006ci\u0063\u0065\u006e\u0073\u0065\u0020\u0063\u006f\u0064\u0065\u003a\u0020\u0025\u0076",_gef );
return ;};};func (_cd *LicenseKey )getExpiryDateToCompare ()_ea .Time {if _cd .Trial {return _ea .Now ().UTC ();};return _fa .ReleasedAt ;};func _be (_bac string ,_fc []byte )(string ,error ){_df ,_ :=_ge .Decode ([]byte (_bac ));if _df ==nil {return "",_gg .Errorf ("\u0050\u0072\u0069\u0076\u004b\u0065\u0079\u0020\u0066a\u0069\u006c\u0065\u0064");
};_gf ,_ca :=_bf .ParsePKCS1PrivateKey (_df .Bytes );if _ca !=nil {return "",_ca ;};_dce :=_cf .New ();_dce .Write (_fc );_gba :=_dce .Sum (nil );_ecb ,_ca :=_bd .SignPKCS1v15 (_baa .Reader ,_gf ,_bb .SHA512 ,_gba );if _ca !=nil {return "",_ca ;};_fb :=_dgg .StdEncoding .EncodeToString (_fc );
_fb +="\u000a\u002b\u000a";_fb +=_dgg .StdEncoding .EncodeToString (_ecb );return _fb ,nil ;};var _ggb map[string ]int ;func (_bec *meteredClient )checkinUsage (_afb meteredUsageCheckinForm )(meteredUsageCheckinResp ,error ){_afb .Package ="\u0075\u006e\u0069\u0070\u0064\u0066";
_afb .PackageVersion =_fa .Version ;var _aedb meteredUsageCheckinResp ;_cg :=_bec ._gbdc +"\u002f\u006d\u0065\u0074er\u0065\u0064\u002f\u0075\u0073\u0061\u0067\u0065\u005f\u0063\u0068\u0065\u0063\u006bi\u006e";_dgb ,_gdb :=_c .Marshal (_afb );if _gdb !=nil {return _aedb ,_gdb ;
};_eea ,_gdb :=_cfgd (_dgb );if _gdb !=nil {return _aedb ,_gdb ;};_eac ,_gdb :=_g .NewRequest ("\u0050\u004f\u0053\u0054",_cg ,_eea );if _gdb !=nil {return _aedb ,_gdb ;};_eac .Header .Add ("\u0043\u006f\u006et\u0065\u006e\u0074\u002d\u0054\u0079\u0070\u0065","\u0061\u0070p\u006c\u0069\u0063a\u0074\u0069\u006f\u006e\u002f\u006a\u0073\u006f\u006e");
_eac .Header .Add ("\u0043\u006fn\u0074\u0065\u006et\u002d\u0045\u006e\u0063\u006f\u0064\u0069\u006e\u0067","\u0067\u007a\u0069\u0070");_eac .Header .Add ("\u0041c\u0063e\u0070\u0074\u002d\u0045\u006e\u0063\u006f\u0064\u0069\u006e\u0067","\u0067\u007a\u0069\u0070");
_eac .Header .Add ("\u0058-\u0041\u0050\u0049\u002d\u004b\u0045Y",_bec ._dcab );_dcc ,_gdb :=_bec ._aab .Do (_eac );if _gdb !=nil {return _aedb ,_gdb ;};defer _dcc .Body .Close ();if _dcc .StatusCode !=200{return _aedb ,_gg .Errorf ("\u0066\u0061i\u006c\u0065\u0064\u0020t\u006f\u0020c\u0068\u0065\u0063\u006b\u0069\u006e\u002c\u0020s\u0074\u0061\u0074\u0075\u0073\u0020\u0063\u006f\u0064\u0065\u0020\u0069s\u003a\u0020\u0025\u0064",_dcc .StatusCode );
};_dcd ,_gdb :=_bcg (_dcc );if _gdb !=nil {return _aedb ,_gdb ;};_gdb =_c .Unmarshal (_dcd ,&_aedb );if _gdb !=nil {return _aedb ,_gdb ;};return _aedb ,nil ;};func _gcd (_acg *_g .Response )(_f .ReadCloser ,error ){var _gcff error ;var _ggfe _f .ReadCloser ;
switch _eb .ToLower (_acg .Header .Get ("\u0043\u006fn\u0074\u0065\u006et\u002d\u0045\u006e\u0063\u006f\u0064\u0069\u006e\u0067")){case "\u0067\u007a\u0069\u0070":_ggfe ,_gcff =_ba .NewReader (_acg .Body );if _gcff !=nil {return _ggfe ,_gcff ;};defer _ggfe .Close ();
default:_ggfe =_acg .Body ;};return _ggfe ,nil ;};func (_aa *LicenseKey )ToString ()string {if _aa ._eab {return "M\u0065t\u0065\u0072\u0065\u0064\u0020\u0073\u0075\u0062s\u0063\u0072\u0069\u0070ti\u006f\u006e";};_aef :=_gg .Sprintf ("\u004ci\u0063e\u006e\u0073\u0065\u0020\u0049\u0064\u003a\u0020\u0025\u0073\u000a",_aa .LicenseId );
_aef +=_gg .Sprintf ("\u0043\u0075s\u0074\u006f\u006de\u0072\u0020\u0049\u0064\u003a\u0020\u0025\u0073\u000a",_aa .CustomerId );_aef +=_gg .Sprintf ("\u0043u\u0073t\u006f\u006d\u0065\u0072\u0020N\u0061\u006de\u003a\u0020\u0025\u0073\u000a",_aa .CustomerName );
_aef +=_gg .Sprintf ("\u0054i\u0065\u0072\u003a\u0020\u0025\u0073\n",_aa .Tier );_aef +=_gg .Sprintf ("\u0043r\u0065a\u0074\u0065\u0064\u0020\u0041\u0074\u003a\u0020\u0025\u0073\u000a",_fa .UtcTimeFormat (_aa .CreatedAt ));if _aa .ExpiresAt ==nil {_aef +="\u0045x\u0070i\u0072\u0065\u0073\u0020\u0041t\u003a\u0020N\u0065\u0076\u0065\u0072\u000a";
}else {_aef +=_gg .Sprintf ("\u0045x\u0070i\u0072\u0065\u0073\u0020\u0041\u0074\u003a\u0020\u0025\u0073\u000a",_fa .UtcTimeFormat (*_aa .ExpiresAt ));};_aef +=_gg .Sprintf ("\u0043\u0072\u0065\u0061\u0074\u006f\u0072\u003a\u0020\u0025\u0073\u0020<\u0025\u0073\u003e\u000a",_aa .CreatorName ,_aa .CreatorEmail );
return _aef ;};func (_dgc *meteredClient )getStatus ()(meteredStatusResp ,error ){var _baaa meteredStatusResp ;_ddd :=_dgc ._gbdc +"\u002fm\u0065t\u0065\u0072\u0065\u0064\u002f\u0073\u0074\u0061\u0074\u0075\u0073";var _gfg meteredStatusForm ;_baf ,_efb :=_c .Marshal (_gfg );
if _efb !=nil {return _baaa ,_efb ;};_bfg ,_efb :=_cfgd (_baf );if _efb !=nil {return _baaa ,_efb ;};_gaa ,_efb :=_g .NewRequest ("\u0050\u004f\u0053\u0054",_ddd ,_bfg );if _efb !=nil {return _baaa ,_efb ;};_gaa .Header .Add ("\u0043\u006f\u006et\u0065\u006e\u0074\u002d\u0054\u0079\u0070\u0065","\u0061\u0070p\u006c\u0069\u0063a\u0074\u0069\u006f\u006e\u002f\u006a\u0073\u006f\u006e");
_gaa .Header .Add ("\u0043\u006fn\u0074\u0065\u006et\u002d\u0045\u006e\u0063\u006f\u0064\u0069\u006e\u0067","\u0067\u007a\u0069\u0070");_gaa .Header .Add ("\u0041c\u0063e\u0070\u0074\u002d\u0045\u006e\u0063\u006f\u0064\u0069\u006e\u0067","\u0067\u007a\u0069\u0070");
_gaa .Header .Add ("\u0058-\u0041\u0050\u0049\u002d\u004b\u0045Y",_dgc ._dcab );_aed ,_efb :=_dgc ._aab .Do (_gaa );if _efb !=nil {return _baaa ,_efb ;};defer _aed .Body .Close ();if _aed .StatusCode !=200{return _baaa ,_gg .Errorf ("\u0066\u0061i\u006c\u0065\u0064\u0020t\u006f\u0020c\u0068\u0065\u0063\u006b\u0069\u006e\u002c\u0020s\u0074\u0061\u0074\u0075\u0073\u0020\u0063\u006f\u0064\u0065\u0020\u0069s\u003a\u0020\u0025\u0064",_aed .StatusCode );
};_agcd ,_efb :=_bcg (_aed );if _efb !=nil {return _baaa ,_efb ;};_efb =_c .Unmarshal (_agcd ,&_baaa );if _efb !=nil {return _baaa ,_efb ;};return _baaa ,nil ;};